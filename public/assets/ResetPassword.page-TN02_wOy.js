import{u as S,e as j,f as h,r as l,g as C,h as P,c as k,j as o,D as N,P as D}from"./index-Dt1aKZms.js";import{u as E,t as R,C as I}from"./zod-By_8XYoU.js";import{A as $}from"./AuthFormLayout-ezUzjv7N.js";class u extends Error{}u.prototype.name="InvalidTokenError";function L(s){return decodeURIComponent(atob(s).replace(/(.)/g,(e,a)=>{let r=a.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function M(s){let e=s.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return L(e)}catch{return atob(e)}}function O(s,e){if(typeof s!="string")throw new u("Invalid token specified: must be a string");e||(e={});const a=e.header===!0?0:1,r=s.split(".")[a];if(typeof r!="string")throw new u(`Invalid token specified: missing part #${a+1}`);let i;try{i=M(r)}catch(t){throw new u(`Invalid token specified: invalid base64 for part #${a+1} (${t.message})`)}try{return JSON.parse(i)}catch(t){throw new u(`Invalid token specified: invalid json for part #${a+1} (${t.message})`)}}const z=()=>{const s=S(),{token:e}=j(),{control:a,handleSubmit:r,formState:{errors:i}}=E({resolver:R(h.getSchema),defaultValues:h.getDefault({token:e})}),[t,m]=l.useState(null),[g,x]=l.useState(0),[d,f]=l.useState(!1),{isError:p,isFetching:w}=C(e,{skip:!e||(t==null?void 0:t.exp)>Date.now()/1e3,refetchOnMountOrArgChange:!0}),[b,{isLoading:v}]=P(),y=async n=>{await b(n).unwrap().then(async()=>{f(!0)})};return l.useEffect(()=>{if(e)try{const n=O(e);m(n),x(function(){const c=Math.floor(Date.now()/1e3);return((n==null?void 0:n.exp)??0)-c}())}catch{m(null)}},[e]),l.useEffect(()=>{(p||!e||(t==null?void 0:t.exp)<Date.now()/1e3||d)&&s(k.public.LOGIN)},[p,t,e,d]),w||!(t!=null&&t.iat)||!(t!=null&&t.exp)?null:o.jsxs($,{title:"Cambiar Contraseña",description:"Ingresa tu nueva contraseña",handleSubmit:r(y),loading:v,disabled:Object.keys(i).length>0||d,buttonLabel:"Cambiar Contraseña",children:[o.jsx("div",{className:"mx-auto",children:o.jsx(N,{isPlaying:!0,duration:t.exp-t.iat,colors:["#01495d","#01a3bb","#f4f6f6"],colorsTime:[7,5,2],size:100,initialRemainingTime:g,strokeWidth:5,trailStrokeWidth:5,trailColor:"#d9d9d9",strokeLinecap:"round",onComplete:()=>{f(!0)},children:({remainingTime:n})=>o.jsxs("div",{className:"flex flex-col items-center justify-center",children:[o.jsx("i",{className:"pi pi-stopwatch text-primary mb-1"}),o.jsx("span",{className:"text-xl font-semibold text-vamos-text",children:A({remainingTime:n})})]})})}),o.jsx("div",{className:"mt-5",children:o.jsx(I,{control:a,name:"newPassword",defaultValue:"aLTEC123488777@",render:({field:n,fieldState:{error:c}})=>o.jsx(D,{label:{htmlFor:"newPassword",text:"Nueva Contraseña",className:"text-tertiary font-bold"},small:{text:c==null?void 0:c.message,className:"text-red-500"},feedback:!1,placeholder:"Contraseña",toggleMask:!0,invalid:!!c,...n})})})]})},A=({remainingTime:s})=>{const e=Math.floor(s%3600/60),a=s%60,r=String(e).padStart(2,"0"),i=String(a).padStart(2,"0");return`${r}:${i}`};export{z as default};
