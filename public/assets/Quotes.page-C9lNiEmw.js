import{J as q,j as e,Y as $,a$ as g,af as R,aS as Se,a_ as ne,r as v,I as de,u as Re,b9 as Me,ba as Te,bb as Ie,B as w,aB as oe,aC as Oe,_ as ke,bc as Le,c as Ve,bd as Be,be as Ge,bf as ce,aN as ue,V as Q,ai as me,b0 as _e,bg as he,bh as ze,bi as Qe,aV as te,ad as O,bj as qe,ae as Ue,X as xe,ab as pe,ar as $e,H as Ke,ag as We,bk as He,bl as Je,bm as Xe,aJ as Ye,a3 as Ze,a4 as ea,a1 as aa}from"./index-DI1O3zWc.js";import{B as re}from"./badge.esm-N3WpyN4R.js";import{U as fe,C as ve,F as D,a as G,b as _,u as je,T as sa}from"./FilterByDate-Dlm3VKgP.js";import{C as i}from"./column.esm-B5q7Iliz.js";import{T as I}from"./tag.esm-DMq9r4V8.js";import{E as ge,D as Ne}from"./ErrorBoundary-B5--NknD.js";import{f as Y}from"./format-D-vkVYqJ.js";import{A as ta}from"./Avatar-DbZDm_dY.js";import{u as ra,t as ia,C as z}from"./zod-JYP6nkbc.js";import{a as be,R as ye}from"./row.esm-CVAiRI7i.js";import"./phoneNumber.adapter-C09bg4A8.js";const la=({options:s})=>{const{users:t}=q(r=>r.users);return e.jsx($,{value:s.value||[],options:t,display:"chip",itemTemplate:r=>e.jsx(fe,{user:r}),onChange:r=>s.filterCallback(r.value,s.index),dataKey:"id",optionLabel:"fullname",placeholder:"Selecciona representantes",maxSelectedLabels:2,className:"p-column-filter"})},na=({options:s})=>e.jsx($,{value:s.value||[],options:Object.values(g).map(t=>({label:R[t].label,id:t})),display:"chip",itemTemplate:({id:t})=>{const{label:r,severity:x,icon:d}=R[t];return e.jsx(I,{value:r,severity:x,icon:d})},onChange:t=>{t.value!==s.value&&s.filterCallback(t.value,s.index)},dataKey:"id",placeholder:"Selecciona un estado",selectAllLabel:"Todos",maxSelectedLabels:2,className:"p-column-filter"}),da=({options:s})=>{const{data:t}=Se();return e.jsx($,{value:s.value||[],options:t==null?void 0:t.data,display:"chip",itemTemplate:r=>e.jsx(ve,{client:r}),dataKey:"id",onChange:r=>s.filterCallback(r.value,s.index),optionLabel:"fullName",placeholder:"Selecciona un cliente",selectAllLabel:"Todos",maxSelectedLabels:2,className:"p-column-filter"})},oa=(s,t)=>Array.isArray(t)&&t.length===0?!0:Array.isArray(t)?t.some(r=>(r==null?void 0:r.id)===s):!1,ca=(s,t)=>Array.isArray(t)&&t.length===0?!0:Array.isArray(t)?t.some(r=>(r==null?void 0:r.id)===s):!1,ua=(s,t)=>Array.isArray(t)&&t.length===0?!0:Array.isArray(t)?t.some(r=>(r==null?void 0:r.id)===s):!1,we=s=>{var t,r,x;return{name:s.name.constraints[0].value??void 0,clientsIds:((t=s["tripDetails.client.id"].constraints[0].value)==null?void 0:t.map(d=>d.id))??void 0,startDate:s["tripDetails.startDate"].constraints[0].value??void 0,endDate:s["tripDetails.endDate"].constraints[0].value??void 0,representativesIds:((r=s["user.id"].constraints[0].value)==null?void 0:r.map(d=>d.id))??void 0,status:((x=s.status.constraints[0].value)==null?void 0:x.map(d=>d.id))??void 0,createdAt:s.createdAt.constraints[0].value??void 0,updatedAt:s.updatedAt.constraints[0].value??void 0}},X=({message:s})=>e.jsxs("span",{className:"text-xs md:text-sm text-gray-400",children:[e.jsx("i",{className:"pi pi-ban"})," ",s]}),ma=({options:s})=>{const[t,{isLoading:r}]=ne(),[x]=v.useState(s.rowData.name);return e.jsx(de,{disabled:r,value:s.rowData.name,className:"max-w-48 text-sm",onChange:d=>{var l;return(l=s.editorCallback)==null?void 0:l.call(s,d.target.value)},onBlur:()=>{s.value===x||!s.value.trim()||t({...s.rowData,name:s.value}).then(()=>{var d;return(d=s.editorCallback)==null?void 0:d.call(s,s.value)})},onKeyDown:d=>{s.value===x||!s.value.trim()||d.key==="Enter"&&t({...s.rowData,name:s.value}).then(()=>{var l;return(l=s.editorCallback)==null?void 0:l.call(s,s.value)})}})},{EDIT_QUOTE:ha}=Ve.private,xa=["Transporte","Actividades","Alimenatación","Guías","Alojamiento"],pa=({type:s,rowData:t})=>{const r=Re(),[x,d]=v.useState(!1),{authUser:l}=q(o=>o.auth),{users:p}=q(o=>o.users),[a,{isLoading:f}]=Me(),[c]=Te(),[N,{isLoading:C}]=Ie(),{control:b,handleSubmit:P}=ra({resolver:ia(Be)}),h=async o=>{var u;await N({subject:o.subject,to:o.to.map(n=>({email:n.email})),resources:o.resources,description:o.description,reservationId:(u=t.tripDetails)==null?void 0:u.id}).unwrap(),await c({from_user:l==null?void 0:l.id,to_user:o.to.map(n=>n.id),message:o.description}).unwrap()},y=o=>e.jsxs("div",{className:`\r
        flex\r
        items-center gap-x-3\r
      `,children:[e.jsx(ta,{badge:{severity:o.online?"success":"danger"},icon:"pi pi-user",shape:"circle"}),e.jsx("p",{className:"font-bold ",children:o.fullname})]});return e.jsxs("div",{className:"space-x-1",children:[e.jsx(w,{rounded:!0,text:!0,icon:"pi pi-pencil",onClick:()=>{r(ha(t==null?void 0:t.id))},disabled:t.status===g.APPROVED&&t.official}),e.jsx(w,{icon:"pi pi-file-pdf",className:"",rounded:!0,text:!0,disabled:f||t.status===g.DRAFT,onClick:()=>{var o,u;t.tripDetails&&a({id:t.id,name:((u=(o=t==null?void 0:t.tripDetails)==null?void 0:o.client)==null?void 0:u.fullName)||""})}}),s==="principal"&&e.jsx(w,{icon:"pi pi-envelope",rounded:!0,disabled:!t.tripDetails,text:!0,onClick:()=>{d(!0)}}),e.jsx(oe,{header:"Enviar correo",visible:x,style:{width:"auto"},onHide:()=>{d(!1)},children:e.jsxs("form",{className:"text-tertiary text-[20px] font-bold mb-4",onSubmit:P(h),children:[e.jsx(z,{name:"subject",control:b,defaultValue:"",render:({field:o,fieldState:{error:u}})=>e.jsx(de,{type:"text",label:{text:"Asunto",className:"text-tertiary text-[20px] font-bold "},placeholder:"Asunto",className:"w-full mb-4",invalid:!!u,...o,small:{text:u==null?void 0:u.message,className:"text-red-500"}})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"",className:`\r
            \r
            `,children:"Para"}),e.jsx(z,{name:"to",control:b,render:({field:o,fieldState:{error:u}})=>e.jsx($,{options:Array.isArray(p)?p==null?void 0:p.map(n=>({...n})):[],multiple:!0,filter:!0,className:"w-full",placeholder:"Para",invalid:!!u,...o,onChange:n=>{o.onChange(n.value)},small:{text:u==null?void 0:u.message,className:"text-red-500"},display:"chip",optionLabel:"fullname",itemTemplate:y})})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{children:e.jsx(z,{name:"resources",control:b,render:({field:o,fieldState:{error:u}})=>e.jsx(Oe,{label:{text:"Recursos"},options:xa,invalid:!!u,...o,onChange:n=>o.onChange(n.value),small:{text:u==null?void 0:u.message,className:"text-red-500"}})})})}),e.jsx(z,{name:"description",control:b,render:({field:o,fieldState:{error:u}})=>e.jsx(ke,{...o,label:{text:"Descripción ( Opcional )"},rows:5,small:{text:u==null?void 0:u.message,className:"text-red-500"}})}),e.jsx("div",{className:"flex justify-end mt-4",children:C?e.jsx(Le,{style:{width:"40px",height:"40px"},strokeWidth:"8"}):e.jsxs(e.Fragment,{children:[e.jsx(w,{label:"Cancelar",onClick:()=>{d(!1)},icon:"pi pi-envelope",type:"submit",className:"mr-4 bg-white text-gray-500"}),e.jsx(w,{label:"Enviar",icon:"pi pi-envelope",type:"submit",disabled:C})]})})]})})]})},fa=({options:s})=>{const[t]=Ge(),[r]=ce();return e.jsx(ue,{value:s.rowData.official,options:[{label:"Oficial",value:!0}],itemTemplate:()=>e.jsx("i",{className:"pi pi-check-circle"}),valueTemplate:()=>e.jsx("i",{className:Q("pi",s.value?"pi-check-circle":"pi-times-circle")}),onChange:x=>{x.value!==s.value&&t({versionNumber:s.rowData.id.versionNumber,quotationId:s.rowData.id.quotationId}).unwrap().then(({data:d})=>{var l;(l=s.editorCallback)==null||l.call(s,x.value),d.newOfficial.status===g.APPROVED&&r({id:0,quotationId:s.rowData.id.quotationId,status:me.PENDING})})},placeholder:"Seleccionar tipo de cotización",className:"w-full"})},va=({options:s,setSelectedQuotation:t})=>{const[r]=ce(),[x]=ne(),d=async l=>{var p;if(l.value!==s.value){if(s.rowData.official&&s.rowData.reservation&&l.value===g.CANCELATED)return t(s.rowData),(p=s.editorCallback)==null?void 0:p.call(s,l.value);l.value===g.APPROVED&&s.rowData.official?r({id:0,status:me.PENDING,quotationId:s.rowData.id.quotationId}).unwrap().then(()=>{var a;(a=s.editorCallback)==null||a.call(s,l.value)}):x(_e.parse({...s.rowData,status:l.value})).unwrap().then(()=>{var a;(a=s.editorCallback)==null||a.call(s,l.value)})}};return e.jsx(ue,{value:s.rowData.status,options:[{...R[g.APPROVED],value:g.APPROVED},{...R[g.CANCELATED],value:g.CANCELATED}],itemTemplate:l=>e.jsx(I,{value:l.label,severity:l.severity,icon:l.icon}),valueTemplate:()=>{const{label:l,severity:p,icon:a}=R[s.value];return e.jsx(I,{value:l,severity:p,icon:a})},onChange:d,placeholder:"Seleccionar tipo de cotización",className:"w-full"})},ja={EDIT_REFERENCE:"editReference",CANCEL_RESERVATION:"cancelReservation"},ga=({selectedQuotation:s,setSelectedQuotation:t})=>{var C,b,P;const{currentData:r}=he({limit:10,page:1,quotationId:s==null?void 0:s.id.quotationId,status:[g.APPROVED]},{skip:!s}),[x]=ze(),[d]=Qe(),[l,p]=v.useState("EDIT_REFERENCE"),[a,f]=v.useState(void 0),c=(C=r==null?void 0:r.data)==null?void 0:C.content,N=()=>{var h;if(s){if(l==="CANCEL_RESERVATION"){s.reservation||alert("No se puede cancelar la reserva"),d(((h=s.reservation)==null?void 0:h.id)||0).unwrap().then(()=>{t(void 0)});return}!c||!a||x({quotationId:s.id.quotationId,versionNumber:a}).unwrap().then(()=>{t(void 0)})}};return v.useEffect(()=>{var h;c&&!a&&f((h=c[0])==null?void 0:h.id.versionNumber)},[c]),e.jsxs(oe,{header:"Motivo de cancelación",headerClassName:"text-primary",visible:!!s,onHide:()=>t(void 0),style:{maxWidth:"30rem"},children:[e.jsx("p",{className:"text-center",children:"Estas a punto de cancelar la versión oficial. Se debe seleccionar otra versión aprobada para reemplazarla."}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-4",children:[e.jsx("h4",{className:"font-bold mb-2 text-primary",children:"Cotización oficial actual"}),e.jsxs("div",{className:"ml-3 grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"ID:"})," ",s.id.quotationId]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Version:"})," v",s.id.versionNumber]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Cliente: "}),(P=(b=s.tripDetails)==null?void 0:b.client)==null?void 0:P.fullName]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Monto: "}),Y(s.finalPrice||0)]})]})]}),l==="EDIT_REFERENCE"&&e.jsxs("div",{className:"my-4",children:[e.jsx("h4",{className:"font-bold mb-2 text-primary",children:"Seleccionar otra versión"}),c&&c.length>0&&(c==null?void 0:c.map(h=>e.jsxs("div",{className:"ml-3 flex align-items-center",children:[e.jsx(te,{inputId:h.id.versionNumber.toString(),name:"version",value:h.id.versionNumber,checked:a===h.id.versionNumber,onChange:y=>{f(Number(y.target.value))}}),e.jsxs("label",{htmlFor:h.id.versionNumber.toString(),className:"ml-2",children:["Versión ",h.id.versionNumber,e.jsxs("span",{className:"text-gray-400 block",children:[Y(h.finalPrice||0)," -",O.format(h.createdAt)]})]})]},h.id.versionNumber))),(c==null?void 0:c.length)===0&&e.jsx("p",{className:"ml-3 text-gray-400",children:"No hay cotizaciones aprobadas"})]}),e.jsxs("div",{className:"my-4",children:[e.jsx("h4",{className:"font-bold mb-2 text-primary",children:"Acción de la reserva"}),Object.entries(ja).map(([h,y])=>e.jsxs("div",{className:"ml-3 flex align-items-center",children:[e.jsx(te,{inputId:y,checked:l===h,value:h,onChange:o=>{p(o.target.value)}}),e.jsxs("label",{htmlFor:y,className:"ml-2",children:[h==="EDIT_REFERENCE"?"Editar la referencia":"Solo cancelar la reserva",e.jsx("span",{className:"text-gray-400 block",children:h==="EDIT_REFERENCE"?"Mantener la reserva actual y editar la referencia a la nueva versión seleccionada":"Cancelar la reserva actual sin reemplazarla por otra"})]})]},h))]}),e.jsxs("div",{className:"mt-10 md:flex gap-x-2 justify-end",children:[e.jsx(w,{disabled:(c==null?void 0:c.length)===0&&l==="EDIT_REFERENCE",onClick:N,label:"Aplicar cambios",className:"max-sm:w-full"}),e.jsx(w,{label:"Cancelar",outlined:!0,onClick:()=>t(void 0),className:"max-sm:w-full max-sm:mt-2"})]})]})]})},U=v.forwardRef(function({extraColumns:t,...r},x){const d=v.createRef();v.useImperativeHandle(x,()=>({exportCSV:()=>{var a;return(a=d.current)==null?void 0:a.exportCSV()}}));const[l,p]=v.useState();return e.jsxs(e.Fragment,{children:[e.jsx(ga,{selectedQuotation:l,setSelectedQuotation:p}),e.jsxs(qe,{...r,size:"small",pt:{wrapper:{className:"thin-scrollbar"},...r.pt},ref:d,className:Q("max-sm:text-xs",r.className),children:[t==null?void 0:t.filter(({position:a})=>a==="start").map(({position:a,...f},c)=>e.jsx(i,{...f},c)),e.jsx(i,{selectionMode:"multiple"}),e.jsx(i,{field:"id",headerClassName:"min-w-24",className:"min-w-24",header:"Código",body:a=>e.jsxs("label",{children:["Q",a.id.quotationId,"-V",a.id.versionNumber]})}),e.jsx(i,{field:"name",header:"Nombre",filter:!0,editor:a=>a.rowData.status===g.APPROVED&&a.rowData.official?e.jsx("label",{children:a.rowData.name}):e.jsx(ma,{options:a}),headerClassName:"min-w-48",className:"min-w-48",showFilterMatchModes:!1,showFilterOperator:!1,showAddButton:!1,filterField:"name",filterPlaceholder:"Buscar por nombre",filterMenuClassName:"max-md:w-48",filterClear:a=>e.jsx(D,{...a}),filterApply:a=>e.jsx(G,{...a})}),e.jsx(i,{filter:!0,showFilterOperator:!1,showAddButton:!1,header:"Cliente",headerClassName:"min-w-64",body:a=>{if(!a.tripDetails)return e.jsx(X,{message:"No se ha asignado un cliente"});const f=a.tripDetails.client;return e.jsx(ve,{client:f})},filterMatchMode:"custom",filterFunction:ca,filterType:"custom",filterField:"tripDetails.client.id",filterPlaceholder:"Buscar por cliente",showFilterMatchModes:!1,className:"min-w-64",filterClear:a=>e.jsx(D,{...a}),filterApply:a=>e.jsx(G,{...a}),filterElement:a=>e.jsx(da,{options:a})}),e.jsx(i,{field:"tripDetails.numberOfPeople",header:"Pasajeros",className:"min-w-24",headerClassName:"min-w-24",body:a=>{var f;return((f=a==null?void 0:a.tripDetails)==null?void 0:f.numberOfPeople)||0}}),e.jsx(i,{header:"Fecha de inicio",className:"min-w-32",headerClassName:"min-w-32",filterMenuStyle:{width:"16rem"},dataType:"date",filter:!0,showFilterOperator:!1,showAddButton:!1,showFilterMatchModes:!1,showApplyButton:!1,filterField:"tripDetails.startDate",filterClear:a=>e.jsx(D,{...a}),body:a=>a.tripDetails?O.format(a.tripDetails.startDate):e.jsx(X,{message:"No se ha asignado una fecha de inicio"}),filterElement:a=>e.jsx(_,{options:a,placeholder:"Fecha de inicio"})}),e.jsx(i,{header:"Fecha fin",className:"min-w-32",headerClassName:"min-w-32",dataType:"date",filter:!0,showFilterOperator:!1,showAddButton:!1,showFilterMatchModes:!1,showApplyButton:!1,filterPlaceholder:"Buscar por fecha",filterField:"tripDetails.endDate",filterClear:a=>e.jsx(D,{...a}),body:a=>a.tripDetails?O.format(a.tripDetails.endDate):e.jsx(X,{message:"No se ha asignado una fecha de fin"}),filterElement:a=>e.jsx(_,{options:a,placeholder:"Fecha de fin"})}),e.jsx(i,{header:"Representante",showFilterMatchModes:!1,showFilterOperator:!1,showAddButton:!1,filterMenuStyle:{width:"16rem"},filter:!0,filterMatchMode:"custom",headerClassName:"min-w-32",className:"min-w-56",filterType:"custom",filterField:"user.id",filterFunction:ua,body:a=>e.jsx(fe,{user:a.user}),filterClear:a=>e.jsx(D,{...a}),filterApply:a=>e.jsx(G,{...a}),filterElement:a=>e.jsx(la,{options:a})}),e.jsx(i,{field:"completionPercentage",header:"Avance",body:a=>e.jsx(Ue,{value:a.completionPercentage,showValue:!1,className:"h-2"})}),e.jsx(i,{field:"finalPrice",header:"Precio",body:a=>Y(a.finalPrice||0)}),e.jsx(i,{field:"status",header:"Status",filter:!0,filterMatchMode:"custom",filterFunction:oa,filterType:"custom",editor:a=>{if(a.rowData.status!==g.COMPLETED&&a.rowData.status!==g.APPROVED&&a.rowData.status!==g.CANCELATED){const{label:f,icon:c,severity:N}=R[a.rowData.status];return e.jsx(I,{value:f,icon:c,severity:N})}return e.jsx(va,{options:a,setSelectedQuotation:p})},showFilterMatchModes:!1,showFilterOperator:!1,showAddButton:!1,body:a=>{const{label:f,icon:c,severity:N}=R[a.status];return e.jsx(I,{value:f,icon:c,severity:N})},filterClear:a=>e.jsx(D,{...a}),filterApply:a=>e.jsx(G,{...a}),filterElement:a=>e.jsx(na,{options:a})}),e.jsx(i,{field:"official",header:"Oficial",align:"center",editor:a=>a.rowData.official?e.jsx("i",{className:Q("pi",{"pi-check-circle":a.rowData.official},{"pi-times-circle":!a.rowData.official})}):e.jsx(fa,{options:a}),body:a=>e.jsx("i",{className:Q("pi",{"pi-check-circle":a.official},{"pi-times-circle":!a.official})})}),t==null?void 0:t.filter(({position:a})=>a==="end").map(({position:a,...f},c)=>e.jsx(i,{...f},c)),e.jsx(i,{header:"Fecha de creación",className:"min-w-32",headerClassName:"min-w-32",filterMenuStyle:{width:"16rem"},dataType:"date",filter:!0,showFilterOperator:!1,showAddButton:!1,showFilterMatchModes:!1,showApplyButton:!1,filterField:"createdAt",field:"createdAt",filterClear:a=>e.jsx(D,{...a}),body:a=>O.format(a.createdAt,"dd/MM/yyyy"),filterElement:a=>e.jsx(_,{options:a,placeholder:"Fecha de creación"})}),e.jsx(i,{header:"Última modificación",className:"min-w-32",headerClassName:"min-w-32",filterMenuStyle:{width:"16rem"},dataType:"date",filter:!0,showFilterOperator:!1,showAddButton:!1,showFilterMatchModes:!1,showApplyButton:!1,filterField:"updatedAt",field:"updatedAt",filterClear:a=>e.jsx(D,{...a}),body:a=>O.format(a.updatedAt,"dd/MM/yyyy"),filterElement:a=>e.jsx(_,{options:a,placeholder:"Fecha de ultima modificación"})}),e.jsx(i,{header:"Acciones",body:a=>e.jsx(pa,{rowData:a,type:"principal"}),exportable:!1,className:"min-w-44"})]})]})}),Na=({currentRowExpanded:s,selectedQuotes:t,setSelectedQuotes:r,recentDuplicatedQuotes:x})=>{var k;const{handlePageChange:d,currentPage:l,first:p,limit:a,filters:f}=je(5),[{name:c,clientsIds:N,startDate:C,endDate:b,representativesIds:P,status:h,createdAt:y,updatedAt:o},u]=v.useState({}),{currentData:n,isLoading:F,isFetching:S,isError:K,refetch:W}=he({page:l,limit:a,name:c,clientsIds:N,startDate:C,endDate:b,representativesIds:P,status:h,quotationId:s==null?void 0:s.id.quotationId,createdAt:y,updatedAt:o},{skip:!l||!s});return v.useEffect(()=>{f&&u(we(f))},[f]),e.jsx(ge,{loadingComponent:e.jsx(xe,{pt:{header:{className:"!bg-secondary"}},headerColumnGroup:ba,value:Array.from({length:(n==null?void 0:n.data.content.length)||a}),children:Array.from({length:14}).map((A,M)=>e.jsx(i,{body:()=>e.jsx(pe,{shape:"rectangle",height:"2rem"})},M))}),isLoader:F||S,fallBackComponent:e.jsx(U,{value:[],showGridlines:!0,emptyMessage:e.jsx("div",{className:"p-4",children:e.jsx(Ne,{refetch:W,isFetching:S,isLoading:F,message:"No se pudieron cargar las versiones"})})}),error:K,children:e.jsx(U,{value:((k=n==null?void 0:n.data)==null?void 0:k.content)||[],scrollable:!0,emptyMessage:"No hay versiones disponibles",selectionMode:"checkbox",size:"small",tableStyle:{minWidth:"50rem"},editMode:"cell",selection:t,first:p,rows:a,onFilter:d,filters:f,loading:F||S,onSelectionChange:A=>r(A.value),className:"text-sm lg:text-[15px] p-5 overflow-x-hidden",rowClassName:A=>x.length>0&&x.some(M=>M.id.quotationId===A.id.quotationId&&M.id.versionNumber===A.id.versionNumber)?"bg-green-100":"",pt:{wrapper:{className:"invisible-x-scrollbar thin-y-scrollbar",footer:{className:"bg-white"}}},footer:e.jsx($e,{className:"w-full bg-transparent max-sm:text-xs",first:p,rows:a,totalRecords:n==null?void 0:n.data.total,onPageChange:d,template:"FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{currentPage} de {totalPages} páginas ({totalRecords} registros)"})})})},ba=e.jsx(be,{children:e.jsxs(ye,{children:[e.jsx(i,{header:"Código",headerClassName:"min-w-24"}),e.jsx(i,{header:"Nombre",filter:!0,headerClassName:"min-w-32"}),e.jsx(i,{header:"Cliente",filter:!0,headerClassName:"min-w-48"}),e.jsx(i,{header:"Pasajeros",headerClassName:"min-w-24"}),e.jsx(i,{header:"Fecha de inicio",filter:!0,headerClassName:"min-w-48"}),e.jsx(i,{header:"Fecha de fin",filter:!0,headerClassName:"min-w-32"}),e.jsx(i,{header:"Precio"}),e.jsx(i,{header:"Representante",headerClassName:"min-w-32",filter:!0}),e.jsx(i,{header:"Avance"}),e.jsx(i,{header:"Precio"}),e.jsx(i,{header:"Status",filter:!0}),e.jsx(i,{header:"Oficial",headerClassName:"min-w-24"}),e.jsx(i,{header:"Acciones"})]})}),{QUOTATION_PAGINATION:ie}=Ye,le=[10,20,30],ya=()=>{const s=Ke(),{currentQuotation:t}=q(m=>m.quotation),{handlePageChange:r,currentPage:x,first:d,limit:l,sortField:p,filters:a,handleSaveState:f}=je(le[0],ie),[{name:c,clientsIds:N,startDate:C,endDate:b,representativesIds:P,status:h,createdAt:y,updatedAt:o},u]=v.useState({}),{currentData:n,isFetching:F,isLoading:S,isError:K,refetch:W}=We({page:x,limit:l,name:c,clientsIds:N,startDate:C,endDate:b,representativesIds:P,status:h,createdAt:y,updatedAt:o},{skip:!x}),[k,{isLoading:A}]=He(),[M,{isLoading:H}]=Je(),[Ce,Z]=v.useState(void 0),[E,L]=v.useState([]),[T,Ae]=v.useState([]),[Ee,Pe]=v.useState(),De=async()=>{E.length&&(await k({ids:E.map(m=>m.id)}).unwrap(),Ae([...E]),L([]))},Fe=async()=>{if(!E.length)return;const m=E.filter(j=>!j.reservation);m.length&&(await M({ids:m.map(j=>j.id)}).unwrap().then(({data:j})=>{if(!t)return;const V=t.currentVersion.id;j.versionQuotationsDeleted.forEach(B=>{V.quotationId===B.id.quotationId&&V.versionNumber===B.id.versionNumber&&Ze.deleteCurrentQuotation().then(()=>{s(ea(null))})})}),L([]))};v.useEffect(()=>{a&&u(we(a))},[a]);const J=e.jsxs("div",{className:"flex flex-wrap gap-2 p-2 items-center",children:[e.jsx("h4",{className:"m-0 text-sm md:text-lg",children:"Cotizaciones"}),e.jsx(re,{value:n!=null&&n.data.total?`Total: ${n==null?void 0:n.data.total}`:"Total: 0"}),T.length>0&&e.jsx(re,{value:`${T.length} ${T.length===1?"cotización duplicada":"cotizaciones duplicadas"}`,severity:"success",className:"text-white"})]});return e.jsxs(e.Fragment,{children:[e.jsx(sa,{className:"mt-10 mb-4",start:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{icon:"pi pi-trash",label:"Eliminar",loading:H,onClick:Fe,disabled:!E.length||A||H}),e.jsx(w,{icon:"pi pi-clone",label:"Duplicar",onClick:De,loading:A,severity:"secondary",disabled:!E.length||A||H})]})}),e.jsx(ge,{isLoader:S||F,loadingComponent:e.jsx(xe,{pt:{header:{className:"!bg-secondary"}},showGridlines:!0,header:J,headerColumnGroup:wa,value:Array.from({length:(n==null?void 0:n.data.content.length)||l}),children:Array.from({length:14}).map((m,j)=>e.jsx(i,{body:()=>e.jsx(pe,{shape:"rectangle",height:"1.5rem"})},j))}),fallBackComponent:e.jsx(U,{value:[],header:J,extraColumns:[{expander:m=>m.hasUnofficialVersions,position:"start"}],showGridlines:!0,emptyMessage:e.jsx("div",{className:"p-4",children:e.jsx(Ne,{refetch:W,isFetching:F,isLoading:S,message:"No se pudieron cargar las cotizaciones"})})}),error:K,children:e.jsx(U,{stateStorage:"custom",stateKey:ie,customSaveState:f,value:(n==null?void 0:n.data.content)||[],expandedRows:Ce,extraColumns:[{expander:m=>m.hasUnofficialVersions,position:"start"},{header:"Reserva relacionada",body:m=>{var ee,ae,se;if(!((ee=m==null?void 0:m.reservation)!=null&&ee.id))return"Ninguno";const{icon:j,label:V,severity:B}=Xe[(ae=m.reservation)==null?void 0:ae.status];return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["#",(se=m.reservation)==null?void 0:se.id]}),e.jsx(I,{icon:j,severity:B,value:V})]})},position:"end"}],first:d,rows:l,totalRecords:n==null?void 0:n.data.total,onPage:r,onFilter:r,rowsPerPageOptions:le,loading:S||F,lazy:!0,paginatorClassName:"max-sm:text-xs",size:"small",editMode:"cell",className:"text-sm lg:text-[15px] mt-5",sortMode:"single",dataKey:m=>`${m.id.quotationId}${m.id.versionNumber}`,sortField:p==null?void 0:p.sortField,sortOrder:p==null?void 0:p.sortOrder,filters:a,selectionMode:"checkbox",onRowExpand:m=>{const{id:j}=m.data;Z({[`${j.quotationId}${j.versionNumber}`]:!0}),Pe(m.data)},onRowCollapse:()=>{Z({})},selection:E,onSelectionChange:m=>{L(m.value)},header:J,rowClassName:m=>({"bg-green-100":T.length>0&&T.some(j=>j.id.quotationId===m.id.quotationId&&j.id.versionNumber===m.id.versionNumber)}),rowExpansionTemplate:()=>e.jsx(Na,{selectedQuotes:E,setSelectedQuotes:L,recentDuplicatedQuotes:T,currentRowExpanded:Ee}),tableStyle:{minWidth:"60rem"},paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",paginator:!0,showGridlines:!0,filterDisplay:"menu",currentPageReportTemplate:"Mostrando del {first} al {last} de {totalRecords} cotizaciones",emptyMessage:"No hay cotizaciones"})})]})},wa=e.jsx(be,{children:e.jsxs(ye,{children:[e.jsx(i,{}),e.jsx(i,{header:"Código",headerClassName:"min-w-24"}),e.jsx(i,{header:"Nombre",filter:!0,headerClassName:"min-w-32"}),e.jsx(i,{header:"Cliente",filter:!0,headerClassName:"min-w-48"}),e.jsx(i,{header:"Pasajeros",headerClassName:"min-w-24"}),e.jsx(i,{header:"Fecha de inicio",filter:!0,headerClassName:"min-w-48"}),e.jsx(i,{header:"Fecha de fin",filter:!0,headerClassName:"min-w-32"}),e.jsx(i,{header:"Precio"}),e.jsx(i,{header:"Representante",headerClassName:"min-w-32",filter:!0}),e.jsx(i,{header:"Avance"}),e.jsx(i,{header:"Precio"}),e.jsx(i,{header:"Status",filter:!0}),e.jsx(i,{header:"Oficial",headerClassName:"min-w-24"}),e.jsx(i,{header:"Acciones"})]})}),Oa=()=>e.jsxs("div",{className:"bg-white p-10 rounded-lg shadow-md overflow-x-hidden",children:[e.jsxs("div",{className:"flex justify-end flex-wrap gap-y-5 space-x-4",children:[e.jsx(w,{label:"Exportar",className:"bg-transparent text-black border-[#D0D5DD]",icon:"pi pi-download"}),e.jsx(aa,{})]}),e.jsx(ya,{})]});export{Oa as default};
