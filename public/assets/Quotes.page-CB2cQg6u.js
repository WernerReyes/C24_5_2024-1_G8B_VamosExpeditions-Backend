import{$ as q,j as e,b8 as U,a_ as g,V as S,aL as Fe,aZ as ne,r as v,I as de,u as Se,b9 as Te,ba as Me,bb as Ie,B as w,at as oe,au as Oe,bc as ke,aQ as Le,bd as Ve,c as Be,be as Qe,Q as Ge,bf as ze,bg as ce,aG as ue,H as _,Y as me,a$ as _e,bh as he,bi as qe,bj as $e,aO as te,M as O,bk as Ue,aT as l,N as We,aS as xe,S as fe,ai as Ke,aj as He,W as Ye,bl as Xe,bm as Ze,aV as re,bn as Je,aC as ea,aX as aa,aY as sa,a1 as ta}from"./index-Dt1aKZms.js";import{U as pe,C as ve,F as R,a as Q,b as G,u as je,T as ra}from"./FilterByDate-BaCTqg0F.js";import{T as I}from"./tag.esm-BCyuLNqS.js";import{E as ge,D as Ne}from"./ErrorBoundary-CPBQuwol.js";import{f as Z}from"./format-D-vkVYqJ.js";import{u as ia,t as la,C as z}from"./zod-By_8XYoU.js";import{a as be,R as ye}from"./row.esm-CnmUr9LK.js";import"./phoneNumber.adapter-C09bg4A8.js";const na=({options:s})=>{const{users:t}=q(r=>r.users);return e.jsx(U,{value:s.value||[],options:t,display:"chip",itemTemplate:r=>e.jsx(pe,{user:r}),onChange:r=>s.filterCallback(r.value,s.index),dataKey:"id",optionLabel:"fullname",placeholder:"Selecciona representantes",maxSelectedLabels:2,className:"p-column-filter max-w-56"})},da=({options:s})=>e.jsx(U,{value:s.value||[],options:Object.values(g).map(t=>({label:S[t].label,id:t})),display:"chip",itemTemplate:({id:t})=>{const{label:r,severity:x,icon:o}=S[t];return e.jsx(I,{value:r,severity:x,icon:o})},onChange:t=>{t.value!==s.value&&s.filterCallback(t.value,s.index)},dataKey:"id",placeholder:"Selecciona un estado",selectAllLabel:"Todos",maxSelectedLabels:2,className:"p-column-filter"}),oa=({options:s})=>{const{data:t}=Fe();return e.jsx(U,{value:s.value||[],options:t==null?void 0:t.data,display:"chip",itemTemplate:r=>e.jsx(ve,{client:r}),dataKey:"id",onChange:r=>s.filterCallback(r.value,s.index),optionLabel:"fullName",placeholder:"Selecciona un cliente",selectAllLabel:"Todos",maxSelectedLabels:2,className:"p-column-filter max-w-56"})},ca=(s,t)=>Array.isArray(t)&&t.length===0?!0:Array.isArray(t)?t.some(r=>(r==null?void 0:r.id)===s):!1,ua=(s,t)=>Array.isArray(t)&&t.length===0?!0:Array.isArray(t)?t.some(r=>(r==null?void 0:r.id)===s):!1,ma=(s,t)=>Array.isArray(t)&&t.length===0?!0:Array.isArray(t)?t.some(r=>(r==null?void 0:r.id)===s):!1,we=s=>{var t,r,x;return{name:s.name.constraints[0].value??void 0,clientsIds:((t=s["tripDetails.client.id"].constraints[0].value)==null?void 0:t.map(o=>o.id))??void 0,startDate:s["tripDetails.startDate"].constraints[0].value??void 0,endDate:s["tripDetails.endDate"].constraints[0].value??void 0,representativesIds:((r=s["user.id"].constraints[0].value)==null?void 0:r.map(o=>o.id))??void 0,status:((x=s.status.constraints[0].value)==null?void 0:x.map(o=>o.id))??void 0,createdAt:s.createdAt.constraints[0].value??void 0,updatedAt:s.updatedAt.constraints[0].value??void 0}},X=({message:s})=>e.jsxs("span",{className:"text-xs md:text-sm text-gray-400",children:[e.jsx("i",{className:"pi pi-ban"})," ",s]}),ha=({options:s})=>{const[t,{isLoading:r}]=ne(),[x]=v.useState(s.rowData.name);return e.jsx(de,{disabled:r,value:s.rowData.name,className:"max-w-48 text-sm",onChange:o=>{var i;return(i=s.editorCallback)==null?void 0:i.call(s,o.target.value)},onBlur:()=>{s.value===x||!s.value.trim()||t({...s.rowData,name:s.value}).then(()=>{var o;return(o=s.editorCallback)==null?void 0:o.call(s,s.value)})},onKeyDown:o=>{s.value===x||!s.value.trim()||o.key==="Enter"&&t({...s.rowData,name:s.value}).then(()=>{var i;return(i=s.editorCallback)==null?void 0:i.call(s,s.value)})}})},{EDIT_QUOTE:xa}=Be.private,fa=({type:s,rowData:t})=>{const r=Se(),[x,o]=v.useState(!1),{authUser:i}=q(n=>n.auth),{users:p}=q(n=>n.users),[a,{isLoading:f}]=Te(),[c,{isLoading:N}]=Me(),{control:b,handleSubmit:P,setValue:C}=ia({resolver:la(Ie.schema)}),h=async n=>{await c({subject:n.subject,to:n.to.map(u=>({email:u.email})),resources:n.resources,description:n.description,versionQuotationId:n.versionQuotationId,from:n.from}).unwrap(),Qe.sendNotification({from_user:i==null?void 0:i.id,to_user:n.to.map(u=>u.id),message:n.description})},y=n=>e.jsxs("div",{className:`\r
        flex\r
        items-center gap-x-3\r
      `,children:[e.jsx(Ge,{badge:{severity:n.online?"success":"danger"},icon:"pi pi-user",shape:"circle"}),e.jsx("p",{className:"font-bold ",children:n.fullname})]});return v.useEffect(()=>{C("from",(i==null?void 0:i.email)||""),C("versionQuotationId",t.id)},[i,t]),e.jsxs("div",{className:"space-x-1",children:[e.jsx(w,{rounded:!0,text:!0,icon:"pi pi-pencil",onClick:()=>{r(xa(t==null?void 0:t.id))},disabled:t.status===g.APPROVED&&t.official}),e.jsx(w,{icon:"pi pi-file-pdf",className:"",rounded:!0,text:!0,disabled:f||t.status===g.DRAFT,onClick:()=>{var n,u;t.tripDetails&&a({id:t.id,name:((u=(n=t==null?void 0:t.tripDetails)==null?void 0:n.client)==null?void 0:u.fullName)||""})}}),s==="principal"&&e.jsx(w,{icon:"pi pi-envelope",rounded:!0,disabled:!t.tripDetails,text:!0,onClick:()=>{o(!0)}}),e.jsx(oe,{header:"Enviar correo",visible:x,style:{width:"auto"},onHide:()=>{o(!1)},children:e.jsxs("form",{className:"text-tertiary text-[20px] font-bold mb-4",onSubmit:P(h),children:[e.jsx(z,{name:"subject",control:b,defaultValue:"",render:({field:n,fieldState:{error:u}})=>e.jsx(de,{type:"text",label:{text:"Asunto",className:"text-tertiary text-[20px] font-bold "},placeholder:"Asunto",className:"w-full mb-4",invalid:!!u,...n,small:{text:u==null?void 0:u.message,className:"text-red-500"}})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"",className:`\r
            \r
            `,children:"Para"}),e.jsx(z,{name:"to",control:b,render:({field:n,fieldState:{error:u}})=>e.jsx(U,{options:p.filter(d=>d.id!==(i==null?void 0:i.id))||[],multiple:!0,filter:!0,className:"w-full",placeholder:"Para",invalid:!!u,...n,onChange:d=>{n.onChange(d.value)},small:{text:u==null?void 0:u.message,className:"text-red-500"},display:"chip",optionLabel:"fullname",itemTemplate:y})})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{children:e.jsx(z,{name:"resources",control:b,render:({field:n,fieldState:{error:u}})=>e.jsx(Oe,{label:{text:"Recursos"},options:Object.values(ke),optionLabel:"label",optionValue:"value",invalid:!!u,...n,onChange:d=>n.onChange(d.value),itemTemplate:d=>e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx("i",{className:d.icon}),e.jsx("span",{children:d.label})]}),small:{text:u==null?void 0:u.message,className:"text-red-500"}})})})}),e.jsx(z,{name:"description",control:b,render:({field:n,fieldState:{error:u}})=>e.jsx(Le,{...n,label:{text:"Descripción ( Opcional )"},rows:5,small:{text:u==null?void 0:u.message,className:"text-red-500"}})}),e.jsx("div",{className:"flex justify-end mt-4",children:N?e.jsx(Ve,{style:{width:"40px",height:"40px"},strokeWidth:"8"}):e.jsxs(e.Fragment,{children:[e.jsx(w,{label:"Cancelar",onClick:()=>{o(!1)},icon:"pi pi-envelope",type:"submit",className:"mr-4 bg-white text-gray-500"}),e.jsx(w,{label:"Enviar",icon:"pi pi-envelope",type:"submit",disabled:N})]})})]})})]})},pa=({options:s})=>{const[t]=ze(),[r]=ce();return e.jsx(ue,{value:s.rowData.official,options:[{label:"Oficial",value:!0}],itemTemplate:()=>e.jsx("i",{className:"pi pi-check-circle"}),valueTemplate:()=>e.jsx("i",{className:_("pi",s.value?"pi-check-circle":"pi-times-circle")}),onChange:x=>{x.value!==s.value&&t({versionNumber:s.rowData.id.versionNumber,quotationId:s.rowData.id.quotationId}).unwrap().then(({data:o})=>{var i;(i=s.editorCallback)==null||i.call(s,x.value),o.newOfficial.status===g.APPROVED&&r({id:0,quotationId:s.rowData.id.quotationId,status:me.PENDING})})},placeholder:"Seleccionar tipo de cotización",className:"w-full"})},va=({options:s,setSelectedQuotation:t})=>{const[r]=ce(),[x]=ne(),o=async i=>{var p;if(i.value!==s.value){if(s.rowData.official&&s.rowData.reservation&&i.value===g.CANCELATED)return t(s.rowData),(p=s.editorCallback)==null?void 0:p.call(s,i.value);i.value===g.APPROVED&&s.rowData.official?r({id:0,status:me.PENDING,quotationId:s.rowData.id.quotationId}).unwrap().then(()=>{var a;(a=s.editorCallback)==null||a.call(s,i.value)}):x(_e.parse({...s.rowData,status:i.value})).unwrap().then(()=>{var a;(a=s.editorCallback)==null||a.call(s,i.value)})}};return e.jsx(ue,{value:s.rowData.status,options:[{...S[g.APPROVED],value:g.APPROVED},{...S[g.CANCELATED],value:g.CANCELATED}],itemTemplate:i=>e.jsx(I,{value:i.label,severity:i.severity,icon:i.icon}),valueTemplate:()=>{const{label:i,severity:p,icon:a}=S[s.value];return e.jsx(I,{value:i,severity:p,icon:a})},onChange:o,placeholder:"Seleccionar tipo de cotización",className:"w-full"})},ja={EDIT_REFERENCE:"editReference",CANCEL_RESERVATION:"cancelReservation"},ga=({selectedQuotation:s,setSelectedQuotation:t})=>{var b,P,C;const{currentData:r}=he({limit:10,page:1,quotationId:s==null?void 0:s.id.quotationId,status:[g.APPROVED]},{skip:!s}),[x]=qe(),[o]=$e(),[i,p]=v.useState("EDIT_REFERENCE"),[a,f]=v.useState(void 0),c=(b=r==null?void 0:r.data)==null?void 0:b.content,N=()=>{var h;if(s){if(i==="CANCEL_RESERVATION"){s.reservation||alert("No se puede cancelar la reserva"),o(((h=s.reservation)==null?void 0:h.id)||0).unwrap().then(()=>{t(void 0)});return}!c||!a||x({quotationId:s.id.quotationId,versionNumber:a}).unwrap().then(()=>{t(void 0)})}};return v.useEffect(()=>{var h;c&&!a&&f((h=c[0])==null?void 0:h.id.versionNumber)},[c]),e.jsxs(oe,{header:"Motivo de cancelación",headerClassName:"text-primary",visible:!!s,onHide:()=>t(void 0),style:{maxWidth:"30rem"},children:[e.jsx("p",{className:"text-center",children:"Estas a punto de cancelar la versión oficial. Se debe seleccionar otra versión aprobada para reemplazarla."}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-4",children:[e.jsx("h4",{className:"font-bold mb-2 text-primary",children:"Cotización oficial actual"}),e.jsxs("div",{className:"ml-3 grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"ID:"})," ",s.id.quotationId]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Version:"})," v",s.id.versionNumber]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Cliente: "}),(C=(P=s.tripDetails)==null?void 0:P.client)==null?void 0:C.fullName]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Monto: "}),Z(s.finalPrice||0)]})]})]}),i==="EDIT_REFERENCE"&&e.jsxs("div",{className:"my-4",children:[e.jsx("h4",{className:"font-bold mb-2 text-primary",children:"Seleccionar otra versión"}),c&&c.length>0&&(c==null?void 0:c.map(h=>e.jsxs("div",{className:"ml-3 flex align-items-center",children:[e.jsx(te,{inputId:h.id.versionNumber.toString(),name:"version",value:h.id.versionNumber,checked:a===h.id.versionNumber,onChange:y=>{f(Number(y.target.value))}}),e.jsxs("label",{htmlFor:h.id.versionNumber.toString(),className:"ml-2",children:["Versión ",h.id.versionNumber,e.jsxs("span",{className:"text-gray-400 block",children:[Z(h.finalPrice||0)," -",O.format(h.createdAt)]})]})]},h.id.versionNumber))),(c==null?void 0:c.length)===0&&e.jsx("p",{className:"ml-3 text-gray-400",children:"No hay cotizaciones aprobadas"})]}),e.jsxs("div",{className:"my-4",children:[e.jsx("h4",{className:"font-bold mb-2 text-primary",children:"Acción de la reserva"}),Object.entries(ja).map(([h,y])=>e.jsxs("div",{className:"ml-3 flex align-items-center",children:[e.jsx(te,{inputId:y,checked:i===h,value:h,onChange:n=>{p(n.target.value)}}),e.jsxs("label",{htmlFor:y,className:"ml-2",children:[h==="EDIT_REFERENCE"?"Editar la referencia":"Solo cancelar la reserva",e.jsx("span",{className:"text-gray-400 block",children:h==="EDIT_REFERENCE"?"Mantener la reserva actual y editar la referencia a la nueva versión seleccionada":"Cancelar la reserva actual sin reemplazarla por otra"})]})]},h))]}),e.jsxs("div",{className:"mt-10 md:flex gap-x-2 justify-end",children:[e.jsx(w,{disabled:(c==null?void 0:c.length)===0&&i==="EDIT_REFERENCE",onClick:N,label:"Aplicar cambios",className:"max-sm:w-full"}),e.jsx(w,{label:"Cancelar",outlined:!0,onClick:()=>t(void 0),className:"max-sm:w-full max-sm:mt-2"})]})]})]})},$=v.forwardRef(function({extraColumns:t,...r},x){const o=v.createRef();v.useImperativeHandle(x,()=>({exportCSV:()=>{var a;return(a=o.current)==null?void 0:a.exportCSV()}}));const[i,p]=v.useState();return e.jsxs(e.Fragment,{children:[e.jsx(ga,{selectedQuotation:i,setSelectedQuotation:p}),e.jsxs(Ue,{...r,size:"small",pt:{wrapper:{className:"thin-scrollbar"},...r.pt},ref:o,className:_("max-sm:text-xs",r.className),children:[t==null?void 0:t.filter(({position:a})=>a==="start").map(({position:a,...f},c)=>e.jsx(l,{...f},c)),e.jsx(l,{selectionMode:"multiple"}),e.jsx(l,{field:"id",headerClassName:"min-w-24",className:"min-w-24",header:"Código",body:a=>e.jsxs("label",{children:["Q",a.id.quotationId,"-V",a.id.versionNumber]})}),e.jsx(l,{field:"name",header:"Nombre",filter:!0,editor:a=>a.rowData.status===g.APPROVED&&a.rowData.official?e.jsx("label",{children:a.rowData.name}):e.jsx(ha,{options:a}),headerClassName:"min-w-48",className:"min-w-48",showFilterMatchModes:!1,showFilterOperator:!1,showAddButton:!1,filterField:"name",filterPlaceholder:"Buscar por nombre",filterMenuClassName:"max-md:w-48",filterClear:a=>e.jsx(R,{...a}),filterApply:a=>e.jsx(Q,{...a})}),e.jsx(l,{filter:!0,showFilterOperator:!1,showAddButton:!1,header:"Cliente",headerClassName:"min-w-64",body:a=>{if(!a.tripDetails)return e.jsx(X,{message:"No se ha asignado un cliente"});const f=a.tripDetails.client;return e.jsx(ve,{client:f})},filterMatchMode:"custom",filterFunction:ua,filterType:"custom",filterField:"tripDetails.client.id",filterPlaceholder:"Buscar por cliente",showFilterMatchModes:!1,className:"min-w-64",filterClear:a=>e.jsx(R,{...a}),filterApply:a=>e.jsx(Q,{...a}),filterElement:a=>e.jsx(oa,{options:a})}),e.jsx(l,{field:"tripDetails.numberOfPeople",header:"Pasajeros",className:"min-w-24",headerClassName:"min-w-24",body:a=>{var f;return((f=a==null?void 0:a.tripDetails)==null?void 0:f.numberOfPeople)||0}}),e.jsx(l,{header:"Fecha de inicio",className:"min-w-32",headerClassName:"min-w-32",filterMenuStyle:{width:"16rem"},dataType:"date",filter:!0,showFilterOperator:!1,showAddButton:!1,showFilterMatchModes:!1,showApplyButton:!1,filterField:"tripDetails.startDate",filterClear:a=>e.jsx(R,{...a}),body:a=>a.tripDetails?O.format(a.tripDetails.startDate):e.jsx(X,{message:"No se ha asignado una fecha de inicio"}),filterElement:a=>e.jsx(G,{options:a,placeholder:"Fecha de inicio"})}),e.jsx(l,{header:"Fecha fin",className:"min-w-32",headerClassName:"min-w-32",dataType:"date",filter:!0,showFilterOperator:!1,showAddButton:!1,showFilterMatchModes:!1,showApplyButton:!1,filterPlaceholder:"Buscar por fecha",filterField:"tripDetails.endDate",filterClear:a=>e.jsx(R,{...a}),body:a=>a.tripDetails?O.format(a.tripDetails.endDate):e.jsx(X,{message:"No se ha asignado una fecha de fin"}),filterElement:a=>e.jsx(G,{options:a,placeholder:"Fecha de fin"})}),e.jsx(l,{header:"Representante",showFilterMatchModes:!1,showFilterOperator:!1,showAddButton:!1,filterMenuStyle:{width:"16rem"},filter:!0,filterMatchMode:"custom",headerClassName:"min-w-32",className:"min-w-56",filterType:"custom",filterField:"user.id",filterFunction:ma,body:a=>e.jsx(pe,{user:a.user}),filterClear:a=>e.jsx(R,{...a}),filterApply:a=>e.jsx(Q,{...a}),filterElement:a=>e.jsx(na,{options:a})}),e.jsx(l,{field:"completionPercentage",header:"Avance",body:a=>e.jsx(We,{value:a.completionPercentage,showValue:!1,className:"h-2"})}),e.jsx(l,{field:"finalPrice",header:"Precio",body:a=>Z(a.finalPrice||0)}),e.jsx(l,{field:"status",header:"Status",filter:!0,filterMatchMode:"custom",filterFunction:ca,filterType:"custom",editor:a=>{if(a.rowData.status!==g.COMPLETED&&a.rowData.status!==g.APPROVED&&a.rowData.status!==g.CANCELATED){const{label:f,icon:c,severity:N}=S[a.rowData.status];return e.jsx(I,{value:f,icon:c,severity:N})}return e.jsx(va,{options:a,setSelectedQuotation:p})},showFilterMatchModes:!1,showFilterOperator:!1,showAddButton:!1,body:a=>{const{label:f,icon:c,severity:N}=S[a.status];return e.jsx(I,{value:f,icon:c,severity:N})},filterClear:a=>e.jsx(R,{...a}),filterApply:a=>e.jsx(Q,{...a}),filterElement:a=>e.jsx(da,{options:a})}),e.jsx(l,{field:"official",header:"Oficial",align:"center",editor:a=>a.rowData.official?e.jsx("i",{className:_("pi",{"pi-check-circle":a.rowData.official},{"pi-times-circle":!a.rowData.official})}):e.jsx(pa,{options:a}),body:a=>e.jsx("i",{className:_("pi",{"pi-check-circle":a.official},{"pi-times-circle":!a.official})})}),t==null?void 0:t.filter(({position:a})=>a==="end").map(({position:a,...f},c)=>e.jsx(l,{...f},c)),e.jsx(l,{header:"Fecha de creación",className:"min-w-32",headerClassName:"min-w-32",filterMenuStyle:{width:"16rem"},dataType:"date",filter:!0,showFilterOperator:!1,showAddButton:!1,showFilterMatchModes:!1,showApplyButton:!1,filterField:"createdAt",field:"createdAt",filterClear:a=>e.jsx(R,{...a}),body:a=>O.format(a.createdAt,"dd/MM/yyyy"),filterElement:a=>e.jsx(G,{options:a,placeholder:"Fecha de creación"})}),e.jsx(l,{header:"Última modificación",className:"min-w-32",headerClassName:"min-w-32",filterMenuStyle:{width:"16rem"},dataType:"date",filter:!0,showFilterOperator:!1,showAddButton:!1,showFilterMatchModes:!1,showApplyButton:!1,filterField:"updatedAt",field:"updatedAt",filterClear:a=>e.jsx(R,{...a}),body:a=>O.format(a.updatedAt,"dd/MM/yyyy"),filterElement:a=>e.jsx(G,{options:a,placeholder:"Fecha de ultima modificación"})}),e.jsx(l,{header:"Acciones",body:a=>e.jsx(fa,{rowData:a,type:"principal"}),exportable:!1,className:"min-w-44"})]})]})}),Na=({currentRowExpanded:s,selectedQuotes:t,setSelectedQuotes:r,recentDuplicatedQuotes:x})=>{var k;const{handlePageChange:o,currentPage:i,first:p,limit:a,filters:f}=je(5),[{name:c,clientsIds:N,startDate:b,endDate:P,representativesIds:C,status:h,createdAt:y,updatedAt:n},u]=v.useState({}),{currentData:d,isLoading:D,isFetching:F,isError:W,refetch:K}=he({page:i,limit:a,name:c,clientsIds:N,startDate:b,endDate:P,representativesIds:C,status:h,quotationId:s==null?void 0:s.id.quotationId,createdAt:y,updatedAt:n},{skip:!i||!s});return v.useEffect(()=>{f&&u(we(f))},[f]),e.jsx(ge,{loadingComponent:e.jsx(xe,{pt:{header:{className:"!bg-secondary"}},headerColumnGroup:ba,value:Array.from({length:(d==null?void 0:d.data.content.length)||a}),children:Array.from({length:14}).map((A,T)=>e.jsx(l,{body:()=>e.jsx(fe,{shape:"rectangle",height:"2rem"})},T))}),isLoader:D||F,fallBackComponent:e.jsx($,{value:[],showGridlines:!0,emptyMessage:e.jsx("div",{className:"p-4",children:e.jsx(Ne,{refetch:K,isFetching:F,isLoading:D,message:"No se pudieron cargar las versiones"})})}),error:W,children:e.jsx($,{value:((k=d==null?void 0:d.data)==null?void 0:k.content)||[],scrollable:!0,emptyMessage:"No hay versiones disponibles",selectionMode:"checkbox",size:"small",tableStyle:{minWidth:"50rem"},editMode:"cell",selection:t,first:p,rows:a,onFilter:o,filters:f,loading:D||F,onSelectionChange:A=>r(A.value),className:"text-sm lg:text-[15px] p-5 overflow-x-hidden",rowClassName:A=>x.length>0&&x.some(T=>T.id.quotationId===A.id.quotationId&&T.id.versionNumber===A.id.versionNumber)?"bg-green-100":"",pt:{wrapper:{className:"invisible-x-scrollbar thin-y-scrollbar",footer:{className:"bg-white"}}},footer:e.jsx(Ke,{className:"w-full bg-transparent max-sm:text-xs",first:p,rows:a,totalRecords:d==null?void 0:d.data.total,onPageChange:o,template:"FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{currentPage} de {totalPages} páginas ({totalRecords} registros)"})})})},ba=e.jsx(be,{children:e.jsxs(ye,{children:[e.jsx(l,{header:"Código",headerClassName:"min-w-24"}),e.jsx(l,{header:"Nombre",filter:!0,headerClassName:"min-w-32"}),e.jsx(l,{header:"Cliente",filter:!0,headerClassName:"min-w-48"}),e.jsx(l,{header:"Pasajeros",headerClassName:"min-w-24"}),e.jsx(l,{header:"Fecha de inicio",filter:!0,headerClassName:"min-w-48"}),e.jsx(l,{header:"Fecha de fin",filter:!0,headerClassName:"min-w-32"}),e.jsx(l,{header:"Precio"}),e.jsx(l,{header:"Representante",headerClassName:"min-w-32",filter:!0}),e.jsx(l,{header:"Avance"}),e.jsx(l,{header:"Precio"}),e.jsx(l,{header:"Status",filter:!0}),e.jsx(l,{header:"Oficial",headerClassName:"min-w-24"}),e.jsx(l,{header:"Acciones"})]})}),{QUOTATION_PAGINATION:ie}=ea,le=[10,20,30],ya=()=>{const s=He(),{currentQuotation:t}=q(m=>m.quotation),{handlePageChange:r,currentPage:x,first:o,limit:i,sortField:p,filters:a,handleSaveState:f}=je(le[0],ie),[{name:c,clientsIds:N,startDate:b,endDate:P,representativesIds:C,status:h,createdAt:y,updatedAt:n},u]=v.useState({}),{currentData:d,isFetching:D,isLoading:F,isError:W,refetch:K}=Ye({page:x,limit:i,name:c,clientsIds:N,startDate:b,endDate:P,representativesIds:C,status:h,createdAt:y,updatedAt:n},{skip:!x}),[k,{isLoading:A}]=Xe(),[T,{isLoading:H}]=Ze(),[Ce,J]=v.useState(void 0),[E,L]=v.useState([]),[M,Ae]=v.useState([]),[Ee,Pe]=v.useState(),Re=async()=>{E.length&&(await k({ids:E.map(m=>m.id)}).unwrap(),Ae([...E]),L([]))},De=async()=>{if(!E.length)return;const m=E.filter(j=>!j.reservation);m.length&&(await T({ids:m.map(j=>j.id)}).unwrap().then(({data:j})=>{if(!t)return;const V=t.currentVersion.id;j.versionQuotationsDeleted.forEach(B=>{V.quotationId===B.id.quotationId&&V.versionNumber===B.id.versionNumber&&aa.deleteCurrentQuotation().then(()=>{s(sa(null))})})}),L([]))};v.useEffect(()=>{a&&u(we(a))},[a]);const Y=e.jsxs("div",{className:"flex flex-wrap gap-2 p-2 items-center",children:[e.jsx("h4",{className:"m-0 text-sm md:text-lg",children:"Cotizaciones"}),e.jsx(re,{value:d!=null&&d.data.total?`Total: ${d==null?void 0:d.data.total}`:"Total: 0"}),M.length>0&&e.jsx(re,{value:`${M.length} ${M.length===1?"cotización duplicada":"cotizaciones duplicadas"}`,severity:"success",className:"text-white"})]});return e.jsxs(e.Fragment,{children:[e.jsx(ra,{className:"mt-10 mb-4",start:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{icon:"pi pi-trash",label:"Eliminar",loading:H,onClick:De,disabled:!E.length||A||H}),e.jsx(w,{icon:"pi pi-clone",label:"Duplicar",onClick:Re,loading:A,severity:"secondary",disabled:!E.length||A||H})]})}),e.jsx(ge,{isLoader:F||D,loadingComponent:e.jsx(xe,{pt:{header:{className:"!bg-secondary"}},showGridlines:!0,header:Y,headerColumnGroup:wa,value:Array.from({length:(d==null?void 0:d.data.content.length)||i}),children:Array.from({length:14}).map((m,j)=>e.jsx(l,{body:()=>e.jsx(fe,{shape:"rectangle",height:"1.5rem"})},j))}),fallBackComponent:e.jsx($,{value:[],header:Y,extraColumns:[{expander:m=>m.hasUnofficialVersions,position:"start"}],showGridlines:!0,emptyMessage:e.jsx("div",{className:"p-4",children:e.jsx(Ne,{refetch:K,isFetching:D,isLoading:F,message:"No se pudieron cargar las cotizaciones"})})}),error:W,children:e.jsx($,{stateStorage:"custom",stateKey:ie,customSaveState:f,value:(d==null?void 0:d.data.content)||[],expandedRows:Ce,extraColumns:[{expander:m=>m.hasUnofficialVersions,position:"start"},{header:"Reserva relacionada",body:m=>{var ee,ae,se;if(!((ee=m==null?void 0:m.reservation)!=null&&ee.id))return"Ninguno";const{icon:j,label:V,severity:B}=Je[(ae=m.reservation)==null?void 0:ae.status];return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["#",(se=m.reservation)==null?void 0:se.id]}),e.jsx(I,{icon:j,severity:B,value:V})]})},position:"end"}],first:o,rows:i,totalRecords:d==null?void 0:d.data.total,onPage:r,onFilter:r,rowsPerPageOptions:le,loading:F||D,lazy:!0,paginatorClassName:"max-sm:text-xs",size:"small",editMode:"cell",className:"text-sm lg:text-[15px] mt-5",sortMode:"single",dataKey:m=>`${m.id.quotationId}${m.id.versionNumber}`,sortField:p==null?void 0:p.sortField,sortOrder:p==null?void 0:p.sortOrder,filters:a,selectionMode:"checkbox",onRowExpand:m=>{const{id:j}=m.data;J({[`${j.quotationId}${j.versionNumber}`]:!0}),Pe(m.data)},onRowCollapse:()=>{J({})},selection:E,onSelectionChange:m=>{L(m.value)},header:Y,rowClassName:m=>({"bg-green-100":M.length>0&&M.some(j=>j.id.quotationId===m.id.quotationId&&j.id.versionNumber===m.id.versionNumber)}),rowExpansionTemplate:()=>e.jsx(Na,{selectedQuotes:E,setSelectedQuotes:L,recentDuplicatedQuotes:M,currentRowExpanded:Ee}),tableStyle:{minWidth:"60rem"},paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",paginator:!0,showGridlines:!0,filterDisplay:"menu",currentPageReportTemplate:"Mostrando del {first} al {last} de {totalRecords} cotizaciones",emptyMessage:"No hay cotizaciones"})})]})},wa=e.jsx(be,{children:e.jsxs(ye,{children:[e.jsx(l,{}),e.jsx(l,{header:"Código",headerClassName:"min-w-24"}),e.jsx(l,{header:"Nombre",filter:!0,headerClassName:"min-w-32"}),e.jsx(l,{header:"Cliente",filter:!0,headerClassName:"min-w-48"}),e.jsx(l,{header:"Pasajeros",headerClassName:"min-w-24"}),e.jsx(l,{header:"Fecha de inicio",filter:!0,headerClassName:"min-w-48"}),e.jsx(l,{header:"Fecha de fin",filter:!0,headerClassName:"min-w-32"}),e.jsx(l,{header:"Precio"}),e.jsx(l,{header:"Representante",headerClassName:"min-w-32",filter:!0}),e.jsx(l,{header:"Avance"}),e.jsx(l,{header:"Precio"}),e.jsx(l,{header:"Status",filter:!0}),e.jsx(l,{header:"Oficial",headerClassName:"min-w-24"}),e.jsx(l,{header:"Acciones"})]})}),Ta=()=>e.jsxs("div",{className:"bg-white p-10 rounded-lg shadow-md overflow-x-hidden",children:[e.jsxs("div",{className:"flex justify-end flex-wrap gap-y-5 space-x-4",children:[e.jsx(w,{label:"Exportar",className:"bg-transparent text-black border-[#D0D5DD]",icon:"pi pi-download"}),e.jsx(ta,{})]}),e.jsx(ya,{})]});export{Ta as default};
