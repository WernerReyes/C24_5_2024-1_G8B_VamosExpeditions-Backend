import{b8 as Se,b9 as Fe,$ as q,j as e,ba as U,a_ as g,V as F,aL as Me,aZ as ne,r as v,I as oe,u as Te,bb as Ie,bc as Oe,bd as Le,B as w,at as de,au as Ve,be as ke,aQ as Be,bf as Qe,c as Ge,Q as _e,bg as ze,bh as ce,aG as ue,H as z,Y as me,a$ as qe,bi as he,bj as $e,bk as Ue,aO as te,M as O,bl as We,aT as l,N as Ke,aS as xe,S as fe,ai as He,aj as Ye,W as Xe,bm as Ze,bn as Je,aV as re,bo as ea,aC as aa,aX as sa,aY as ta,a1 as ra}from"./index-J8QxsPFL.js";import{U as pe,C as ve,F as D,a as Q,b as G,u as je,T as ia}from"./FilterByDate-DTowN2sB.js";import{T as I}from"./tag.esm-Ct2LU3sU.js";import{E as ge,D as Ne}from"./ErrorBoundary-CM8Y9ZG2.js";import{f as Z}from"./format-D-vkVYqJ.js";import{u as la,t as na,C as _}from"./zod-CN8eM6yK.js";import{a as be,R as ye}from"./row.esm-DmpXZ13p.js";import"./phoneNumber.adapter-C09bg4A8.js";const oa={sendNotification:s=>{try{const[t,r]=Se.create(s);if(r)throw new Error(r.join(", "));const n=Fe.getInstance();n!=null&&n.connected||n==null||n.connect(),n==null||n.emit("personal-message",s)}catch(t){const r=t.message;console.error("Error sending notification:",r)}}},da=({options:s})=>{const{users:t}=q(r=>r.users);return e.jsx(U,{value:s.value||[],options:t,display:"chip",itemTemplate:r=>e.jsx(pe,{user:r}),onChange:r=>s.filterCallback(r.value,s.index),dataKey:"id",optionLabel:"fullname",placeholder:"Selecciona representantes",maxSelectedLabels:2,className:"p-column-filter max-w-56"})},ca=({options:s})=>e.jsx(U,{value:s.value||[],options:Object.values(g).map(t=>({label:F[t].label,id:t})),display:"chip",itemTemplate:({id:t})=>{const{label:r,severity:n,icon:c}=F[t];return e.jsx(I,{value:r,severity:n,icon:c})},onChange:t=>{t.value!==s.value&&s.filterCallback(t.value,s.index)},dataKey:"id",placeholder:"Selecciona un estado",selectAllLabel:"Todos",maxSelectedLabels:2,className:"p-column-filter"}),ua=({options:s})=>{const{data:t}=Me();return e.jsx(U,{value:s.value||[],options:t==null?void 0:t.data,display:"chip",itemTemplate:r=>e.jsx(ve,{client:r}),dataKey:"id",onChange:r=>s.filterCallback(r.value,s.index),optionLabel:"fullName",placeholder:"Selecciona un cliente",selectAllLabel:"Todos",maxSelectedLabels:2,className:"p-column-filter max-w-56"})},ma=(s,t)=>Array.isArray(t)&&t.length===0?!0:Array.isArray(t)?t.some(r=>(r==null?void 0:r.id)===s):!1,ha=(s,t)=>Array.isArray(t)&&t.length===0?!0:Array.isArray(t)?t.some(r=>(r==null?void 0:r.id)===s):!1,xa=(s,t)=>Array.isArray(t)&&t.length===0?!0:Array.isArray(t)?t.some(r=>(r==null?void 0:r.id)===s):!1,we=s=>{var t,r,n;return{name:s.name.constraints[0].value??void 0,clientsIds:((t=s["tripDetails.client.id"].constraints[0].value)==null?void 0:t.map(c=>c.id))??void 0,startDate:s["tripDetails.startDate"].constraints[0].value??void 0,endDate:s["tripDetails.endDate"].constraints[0].value??void 0,representativesIds:((r=s["user.id"].constraints[0].value)==null?void 0:r.map(c=>c.id))??void 0,status:((n=s.status.constraints[0].value)==null?void 0:n.map(c=>c.id))??void 0,createdAt:s.createdAt.constraints[0].value??void 0,updatedAt:s.updatedAt.constraints[0].value??void 0}},X=({message:s})=>e.jsxs("span",{className:"text-xs md:text-sm text-gray-400",children:[e.jsx("i",{className:"pi pi-ban"})," ",s]}),fa=({options:s})=>{const[t,{isLoading:r}]=ne(),[n]=v.useState(s.rowData.name);return e.jsx(oe,{disabled:r,value:s.rowData.name,className:"max-w-48 text-sm",onChange:c=>{var i;return(i=s.editorCallback)==null?void 0:i.call(s,c.target.value)},onBlur:()=>{s.value===n||!s.value.trim()||t({...s.rowData,name:s.value}).then(()=>{var c;return(c=s.editorCallback)==null?void 0:c.call(s,s.value)})},onKeyDown:c=>{s.value===n||!s.value.trim()||c.key==="Enter"&&t({...s.rowData,name:s.value}).then(()=>{var i;return(i=s.editorCallback)==null?void 0:i.call(s,s.value)})}})},{EDIT_QUOTE:pa}=Ge.private,va=({type:s,rowData:t})=>{const r=Te(),[n,c]=v.useState(!1),{authUser:i}=q(o=>o.auth),{users:p}=q(o=>o.users),[a,{isLoading:f}]=Ie(),[u,{isLoading:N}]=Oe(),{control:b,handleSubmit:P,setValue:C}=la({resolver:na(Le.schema)}),x=async o=>{await u({subject:o.subject,to:o.to.map(m=>({email:m.email})),resources:o.resources,description:o.description,versionQuotationId:o.versionQuotationId,from:o.from}).unwrap(),oa.sendNotification({from_user:i==null?void 0:i.id,to_user:o.to.map(m=>m.id),message:o.description})},y=o=>e.jsxs("div",{className:`\r
        flex\r
        items-center gap-x-3\r
      `,children:[e.jsx(_e,{badge:{severity:o.online?"success":"danger"},icon:"pi pi-user",shape:"circle"}),e.jsx("p",{className:"font-bold ",children:o.fullname})]});return v.useEffect(()=>{C("from",(i==null?void 0:i.email)||""),C("versionQuotationId",t.id)},[i,t]),e.jsxs("div",{className:"space-x-1",children:[e.jsx(w,{rounded:!0,text:!0,icon:"pi pi-pencil",onClick:()=>{r(pa(t==null?void 0:t.id))},disabled:t.status===g.APPROVED&&t.official}),e.jsx(w,{icon:"pi pi-file-pdf",className:"",rounded:!0,text:!0,disabled:f||t.status===g.DRAFT,onClick:()=>{var o,m;t.tripDetails&&a({id:t.id,name:((m=(o=t==null?void 0:t.tripDetails)==null?void 0:o.client)==null?void 0:m.fullName)||""})}}),s==="principal"&&e.jsx(w,{icon:"pi pi-envelope",rounded:!0,disabled:!t.tripDetails,text:!0,onClick:()=>{c(!0)}}),e.jsx(de,{header:"Enviar correo",visible:n,style:{width:"auto"},onHide:()=>{c(!1)},children:e.jsxs("form",{className:"text-tertiary text-[20px] font-bold mb-4",onSubmit:P(x),children:[e.jsx(_,{name:"subject",control:b,defaultValue:"",render:({field:o,fieldState:{error:m}})=>e.jsx(oe,{type:"text",label:{text:"Asunto",className:"text-tertiary text-[20px] font-bold "},placeholder:"Asunto",className:"w-full mb-4",invalid:!!m,...o,small:{text:m==null?void 0:m.message,className:"text-red-500"}})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"",className:`\r
            \r
            `,children:"Para"}),e.jsx(_,{name:"to",control:b,render:({field:o,fieldState:{error:m}})=>e.jsx(U,{options:p.filter(d=>d.id!==(i==null?void 0:i.id))||[],multiple:!0,filter:!0,className:"w-full",placeholder:"Para",invalid:!!m,...o,onChange:d=>{o.onChange(d.value)},small:{text:m==null?void 0:m.message,className:"text-red-500"},display:"chip",optionLabel:"fullname",itemTemplate:y})})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{children:e.jsx(_,{name:"resources",control:b,render:({field:o,fieldState:{error:m}})=>e.jsx(Ve,{label:{text:"Recursos"},options:Object.values(ke),optionLabel:"label",optionValue:"value",invalid:!!m,...o,onChange:d=>o.onChange(d.value),itemTemplate:d=>e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx("i",{className:d.icon}),e.jsx("span",{children:d.label})]}),small:{text:m==null?void 0:m.message,className:"text-red-500"}})})})}),e.jsx(_,{name:"description",control:b,render:({field:o,fieldState:{error:m}})=>e.jsx(Be,{...o,label:{text:"Descripción ( Opcional )"},rows:5,small:{text:m==null?void 0:m.message,className:"text-red-500"}})}),e.jsx("div",{className:"flex justify-end mt-4",children:N?e.jsx(Qe,{style:{width:"40px",height:"40px"},strokeWidth:"8"}):e.jsxs(e.Fragment,{children:[e.jsx(w,{label:"Cancelar",onClick:()=>{c(!1)},icon:"pi pi-envelope",type:"submit",className:"mr-4 bg-white text-gray-500"}),e.jsx(w,{label:"Enviar",icon:"pi pi-envelope",type:"submit",disabled:N})]})})]})})]})},ja=({options:s})=>{const[t]=ze(),[r]=ce();return e.jsx(ue,{value:s.rowData.official,options:[{label:"Oficial",value:!0}],itemTemplate:()=>e.jsx("i",{className:"pi pi-check-circle"}),valueTemplate:()=>e.jsx("i",{className:z("pi",s.value?"pi-check-circle":"pi-times-circle")}),onChange:n=>{n.value!==s.value&&t({versionNumber:s.rowData.id.versionNumber,quotationId:s.rowData.id.quotationId}).unwrap().then(({data:c})=>{var i;(i=s.editorCallback)==null||i.call(s,n.value),c.newOfficial.status===g.APPROVED&&r({id:0,quotationId:s.rowData.id.quotationId,status:me.PENDING})})},placeholder:"Seleccionar tipo de cotización",className:"w-full"})},ga=({options:s,setSelectedQuotation:t})=>{const[r]=ce(),[n]=ne(),c=async i=>{var p;if(i.value!==s.value){if(s.rowData.official&&s.rowData.reservation&&i.value===g.CANCELATED)return t(s.rowData),(p=s.editorCallback)==null?void 0:p.call(s,i.value);i.value===g.APPROVED&&s.rowData.official?r({id:0,status:me.PENDING,quotationId:s.rowData.id.quotationId}).unwrap().then(()=>{var a;(a=s.editorCallback)==null||a.call(s,i.value)}):n(qe.parse({...s.rowData,status:i.value})).unwrap().then(()=>{var a;(a=s.editorCallback)==null||a.call(s,i.value)})}};return e.jsx(ue,{value:s.rowData.status,options:[{...F[g.APPROVED],value:g.APPROVED},{...F[g.CANCELATED],value:g.CANCELATED}],itemTemplate:i=>e.jsx(I,{value:i.label,severity:i.severity,icon:i.icon}),valueTemplate:()=>{const{label:i,severity:p,icon:a}=F[s.value];return e.jsx(I,{value:i,severity:p,icon:a})},onChange:c,placeholder:"Seleccionar tipo de cotización",className:"w-full"})},Na={EDIT_REFERENCE:"editReference",CANCEL_RESERVATION:"cancelReservation"},ba=({selectedQuotation:s,setSelectedQuotation:t})=>{var b,P,C;const{currentData:r}=he({limit:10,page:1,quotationId:s==null?void 0:s.id.quotationId,status:[g.APPROVED]},{skip:!s}),[n]=$e(),[c]=Ue(),[i,p]=v.useState("EDIT_REFERENCE"),[a,f]=v.useState(void 0),u=(b=r==null?void 0:r.data)==null?void 0:b.content,N=()=>{var x;if(s){if(i==="CANCEL_RESERVATION"){s.reservation||alert("No se puede cancelar la reserva"),c(((x=s.reservation)==null?void 0:x.id)||0).unwrap().then(()=>{t(void 0)});return}!u||!a||n({quotationId:s.id.quotationId,versionNumber:a}).unwrap().then(()=>{t(void 0)})}};return v.useEffect(()=>{var x;u&&!a&&f((x=u[0])==null?void 0:x.id.versionNumber)},[u]),e.jsxs(de,{header:"Motivo de cancelación",headerClassName:"text-primary",visible:!!s,onHide:()=>t(void 0),style:{maxWidth:"30rem"},children:[e.jsx("p",{className:"text-center",children:"Estas a punto de cancelar la versión oficial. Se debe seleccionar otra versión aprobada para reemplazarla."}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-4",children:[e.jsx("h4",{className:"font-bold mb-2 text-primary",children:"Cotización oficial actual"}),e.jsxs("div",{className:"ml-3 grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"ID:"})," ",s.id.quotationId]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Version:"})," v",s.id.versionNumber]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Cliente: "}),(C=(P=s.tripDetails)==null?void 0:P.client)==null?void 0:C.fullName]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Monto: "}),Z(s.finalPrice||0)]})]})]}),i==="EDIT_REFERENCE"&&e.jsxs("div",{className:"my-4",children:[e.jsx("h4",{className:"font-bold mb-2 text-primary",children:"Seleccionar otra versión"}),u&&u.length>0&&(u==null?void 0:u.map(x=>e.jsxs("div",{className:"ml-3 flex align-items-center",children:[e.jsx(te,{inputId:x.id.versionNumber.toString(),name:"version",value:x.id.versionNumber,checked:a===x.id.versionNumber,onChange:y=>{f(Number(y.target.value))}}),e.jsxs("label",{htmlFor:x.id.versionNumber.toString(),className:"ml-2",children:["Versión ",x.id.versionNumber,e.jsxs("span",{className:"text-gray-400 block",children:[Z(x.finalPrice||0)," -",O.format(x.createdAt)]})]})]},x.id.versionNumber))),(u==null?void 0:u.length)===0&&e.jsx("p",{className:"ml-3 text-gray-400",children:"No hay cotizaciones aprobadas"})]}),e.jsxs("div",{className:"my-4",children:[e.jsx("h4",{className:"font-bold mb-2 text-primary",children:"Acción de la reserva"}),Object.entries(Na).map(([x,y])=>e.jsxs("div",{className:"ml-3 flex align-items-center",children:[e.jsx(te,{inputId:y,checked:i===x,value:x,onChange:o=>{p(o.target.value)}}),e.jsxs("label",{htmlFor:y,className:"ml-2",children:[x==="EDIT_REFERENCE"?"Editar la referencia":"Solo cancelar la reserva",e.jsx("span",{className:"text-gray-400 block",children:x==="EDIT_REFERENCE"?"Mantener la reserva actual y editar la referencia a la nueva versión seleccionada":"Cancelar la reserva actual sin reemplazarla por otra"})]})]},x))]}),e.jsxs("div",{className:"mt-10 md:flex gap-x-2 justify-end",children:[e.jsx(w,{disabled:(u==null?void 0:u.length)===0&&i==="EDIT_REFERENCE",onClick:N,label:"Aplicar cambios",className:"max-sm:w-full"}),e.jsx(w,{label:"Cancelar",outlined:!0,onClick:()=>t(void 0),className:"max-sm:w-full max-sm:mt-2"})]})]})]})},$=v.forwardRef(function({extraColumns:t,...r},n){const c=v.createRef();v.useImperativeHandle(n,()=>({exportCSV:()=>{var a;return(a=c.current)==null?void 0:a.exportCSV()}}));const[i,p]=v.useState();return e.jsxs(e.Fragment,{children:[e.jsx(ba,{selectedQuotation:i,setSelectedQuotation:p}),e.jsxs(We,{...r,size:"small",pt:{wrapper:{className:"thin-scrollbar"},...r.pt},ref:c,className:z("max-sm:text-xs",r.className),children:[t==null?void 0:t.filter(({position:a})=>a==="start").map(({position:a,...f},u)=>e.jsx(l,{...f},u)),e.jsx(l,{selectionMode:"multiple"}),e.jsx(l,{field:"id",headerClassName:"min-w-24",className:"min-w-24",header:"Código",body:a=>e.jsxs("label",{children:["Q",a.id.quotationId,"-V",a.id.versionNumber]})}),e.jsx(l,{field:"name",header:"Nombre",filter:!0,editor:a=>a.rowData.status===g.APPROVED&&a.rowData.official?e.jsx("label",{children:a.rowData.name}):e.jsx(fa,{options:a}),headerClassName:"min-w-48",className:"min-w-48",showFilterMatchModes:!1,showFilterOperator:!1,showAddButton:!1,filterField:"name",filterPlaceholder:"Buscar por nombre",filterMenuClassName:"max-md:w-48",filterClear:a=>e.jsx(D,{...a}),filterApply:a=>e.jsx(Q,{...a})}),e.jsx(l,{filter:!0,showFilterOperator:!1,showAddButton:!1,header:"Cliente",headerClassName:"min-w-64",body:a=>{if(!a.tripDetails)return e.jsx(X,{message:"No se ha asignado un cliente"});const f=a.tripDetails.client;return e.jsx(ve,{client:f})},filterMatchMode:"custom",filterFunction:ha,filterType:"custom",filterField:"tripDetails.client.id",filterPlaceholder:"Buscar por cliente",showFilterMatchModes:!1,className:"min-w-64",filterClear:a=>e.jsx(D,{...a}),filterApply:a=>e.jsx(Q,{...a}),filterElement:a=>e.jsx(ua,{options:a})}),e.jsx(l,{field:"tripDetails.numberOfPeople",header:"Pasajeros",className:"min-w-24",headerClassName:"min-w-24",body:a=>{var f;return((f=a==null?void 0:a.tripDetails)==null?void 0:f.numberOfPeople)||0}}),e.jsx(l,{header:"Fecha de inicio",className:"min-w-32",headerClassName:"min-w-32",filterMenuStyle:{width:"16rem"},dataType:"date",filter:!0,showFilterOperator:!1,showAddButton:!1,showFilterMatchModes:!1,showApplyButton:!1,filterField:"tripDetails.startDate",filterClear:a=>e.jsx(D,{...a}),body:a=>a.tripDetails?O.format(a.tripDetails.startDate):e.jsx(X,{message:"No se ha asignado una fecha de inicio"}),filterElement:a=>e.jsx(G,{options:a,placeholder:"Fecha de inicio"})}),e.jsx(l,{header:"Fecha fin",className:"min-w-32",headerClassName:"min-w-32",dataType:"date",filter:!0,showFilterOperator:!1,showAddButton:!1,showFilterMatchModes:!1,showApplyButton:!1,filterPlaceholder:"Buscar por fecha",filterField:"tripDetails.endDate",filterClear:a=>e.jsx(D,{...a}),body:a=>a.tripDetails?O.format(a.tripDetails.endDate):e.jsx(X,{message:"No se ha asignado una fecha de fin"}),filterElement:a=>e.jsx(G,{options:a,placeholder:"Fecha de fin"})}),e.jsx(l,{header:"Representante",showFilterMatchModes:!1,showFilterOperator:!1,showAddButton:!1,filterMenuStyle:{width:"16rem"},filter:!0,filterMatchMode:"custom",headerClassName:"min-w-32",className:"min-w-56",filterType:"custom",filterField:"user.id",filterFunction:xa,body:a=>e.jsx(pe,{user:a.user}),filterClear:a=>e.jsx(D,{...a}),filterApply:a=>e.jsx(Q,{...a}),filterElement:a=>e.jsx(da,{options:a})}),e.jsx(l,{field:"completionPercentage",header:"Avance",body:a=>e.jsx(Ke,{value:a.completionPercentage,showValue:!1,className:"h-2"})}),e.jsx(l,{field:"finalPrice",header:"Precio",body:a=>Z(a.finalPrice||0)}),e.jsx(l,{field:"status",header:"Status",filter:!0,filterMatchMode:"custom",filterFunction:ma,filterType:"custom",editor:a=>{if(a.rowData.status!==g.COMPLETED&&a.rowData.status!==g.APPROVED&&a.rowData.status!==g.CANCELATED){const{label:f,icon:u,severity:N}=F[a.rowData.status];return e.jsx(I,{value:f,icon:u,severity:N})}return e.jsx(ga,{options:a,setSelectedQuotation:p})},showFilterMatchModes:!1,showFilterOperator:!1,showAddButton:!1,body:a=>{const{label:f,icon:u,severity:N}=F[a.status];return e.jsx(I,{value:f,icon:u,severity:N})},filterClear:a=>e.jsx(D,{...a}),filterApply:a=>e.jsx(Q,{...a}),filterElement:a=>e.jsx(ca,{options:a})}),e.jsx(l,{field:"official",header:"Oficial",align:"center",editor:a=>a.rowData.official?e.jsx("i",{className:z("pi",{"pi-check-circle":a.rowData.official},{"pi-times-circle":!a.rowData.official})}):e.jsx(ja,{options:a}),body:a=>e.jsx("i",{className:z("pi",{"pi-check-circle":a.official},{"pi-times-circle":!a.official})})}),t==null?void 0:t.filter(({position:a})=>a==="end").map(({position:a,...f},u)=>e.jsx(l,{...f},u)),e.jsx(l,{header:"Fecha de creación",className:"min-w-32",headerClassName:"min-w-32",filterMenuStyle:{width:"16rem"},dataType:"date",filter:!0,showFilterOperator:!1,showAddButton:!1,showFilterMatchModes:!1,showApplyButton:!1,filterField:"createdAt",field:"createdAt",filterClear:a=>e.jsx(D,{...a}),body:a=>O.format(a.createdAt,"dd/MM/yyyy"),filterElement:a=>e.jsx(G,{options:a,placeholder:"Fecha de creación"})}),e.jsx(l,{header:"Última modificación",className:"min-w-32",headerClassName:"min-w-32",filterMenuStyle:{width:"16rem"},dataType:"date",filter:!0,showFilterOperator:!1,showAddButton:!1,showFilterMatchModes:!1,showApplyButton:!1,filterField:"updatedAt",field:"updatedAt",filterClear:a=>e.jsx(D,{...a}),body:a=>O.format(a.updatedAt,"dd/MM/yyyy"),filterElement:a=>e.jsx(G,{options:a,placeholder:"Fecha de ultima modificación"})}),e.jsx(l,{header:"Acciones",body:a=>e.jsx(va,{rowData:a,type:"principal"}),exportable:!1,className:"min-w-44"})]})]})}),ya=({currentRowExpanded:s,selectedQuotes:t,setSelectedQuotes:r,recentDuplicatedQuotes:n})=>{var L;const{handlePageChange:c,currentPage:i,first:p,limit:a,filters:f}=je(5),[{name:u,clientsIds:N,startDate:b,endDate:P,representativesIds:C,status:x,createdAt:y,updatedAt:o},m]=v.useState({}),{currentData:d,isLoading:R,isFetching:S,isError:W,refetch:K}=he({page:i,limit:a,name:u,clientsIds:N,startDate:b,endDate:P,representativesIds:C,status:x,quotationId:s==null?void 0:s.id.quotationId,createdAt:y,updatedAt:o},{skip:!i||!s});return v.useEffect(()=>{f&&m(we(f))},[f]),e.jsx(ge,{loadingComponent:e.jsx(xe,{pt:{header:{className:"!bg-secondary"}},headerColumnGroup:wa,value:Array.from({length:(d==null?void 0:d.data.content.length)||a}),children:Array.from({length:14}).map((A,M)=>e.jsx(l,{body:()=>e.jsx(fe,{shape:"rectangle",height:"2rem"})},M))}),isLoader:R||S,fallBackComponent:e.jsx($,{value:[],showGridlines:!0,emptyMessage:e.jsx("div",{className:"p-4",children:e.jsx(Ne,{refetch:K,isFetching:S,isLoading:R,message:"No se pudieron cargar las versiones"})})}),error:W,children:e.jsx($,{value:((L=d==null?void 0:d.data)==null?void 0:L.content)||[],scrollable:!0,emptyMessage:"No hay versiones disponibles",selectionMode:"checkbox",size:"small",tableStyle:{minWidth:"50rem"},editMode:"cell",selection:t,first:p,rows:a,onFilter:c,filters:f,loading:R||S,onSelectionChange:A=>r(A.value),className:"text-sm lg:text-[15px] p-5 overflow-x-hidden",rowClassName:A=>n.length>0&&n.some(M=>M.id.quotationId===A.id.quotationId&&M.id.versionNumber===A.id.versionNumber)?"bg-green-100":"",pt:{wrapper:{className:"invisible-x-scrollbar thin-y-scrollbar",footer:{className:"bg-white"}}},footer:e.jsx(He,{className:"w-full bg-transparent max-sm:text-xs",first:p,rows:a,totalRecords:d==null?void 0:d.data.total,onPageChange:c,template:"FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{currentPage} de {totalPages} páginas ({totalRecords} registros)"})})})},wa=e.jsx(be,{children:e.jsxs(ye,{children:[e.jsx(l,{header:"Código",headerClassName:"min-w-24"}),e.jsx(l,{header:"Nombre",filter:!0,headerClassName:"min-w-32"}),e.jsx(l,{header:"Cliente",filter:!0,headerClassName:"min-w-48"}),e.jsx(l,{header:"Pasajeros",headerClassName:"min-w-24"}),e.jsx(l,{header:"Fecha de inicio",filter:!0,headerClassName:"min-w-48"}),e.jsx(l,{header:"Fecha de fin",filter:!0,headerClassName:"min-w-32"}),e.jsx(l,{header:"Precio"}),e.jsx(l,{header:"Representante",headerClassName:"min-w-32",filter:!0}),e.jsx(l,{header:"Avance"}),e.jsx(l,{header:"Precio"}),e.jsx(l,{header:"Status",filter:!0}),e.jsx(l,{header:"Oficial",headerClassName:"min-w-24"}),e.jsx(l,{header:"Acciones"})]})}),{QUOTATION_PAGINATION:ie}=aa,le=[10,20,30],Ca=()=>{const s=Ye(),{currentQuotation:t}=q(h=>h.quotation),{handlePageChange:r,currentPage:n,first:c,limit:i,sortField:p,filters:a,handleSaveState:f}=je(le[0],ie),[{name:u,clientsIds:N,startDate:b,endDate:P,representativesIds:C,status:x,createdAt:y,updatedAt:o},m]=v.useState({}),{currentData:d,isFetching:R,isLoading:S,isError:W,refetch:K}=Xe({page:n,limit:i,name:u,clientsIds:N,startDate:b,endDate:P,representativesIds:C,status:x,createdAt:y,updatedAt:o},{skip:!n}),[L,{isLoading:A}]=Ze(),[M,{isLoading:H}]=Je(),[Ce,J]=v.useState(void 0),[E,V]=v.useState([]),[T,Ae]=v.useState([]),[Ee,Pe]=v.useState(),De=async()=>{E.length&&(await L({ids:E.map(h=>h.id)}).unwrap(),Ae([...E]),V([]))},Re=async()=>{if(!E.length)return;const h=E.filter(j=>!j.reservation);h.length&&(await M({ids:h.map(j=>j.id)}).unwrap().then(({data:j})=>{if(!t)return;const k=t.currentVersion.id;j.versionQuotationsDeleted.forEach(B=>{k.quotationId===B.id.quotationId&&k.versionNumber===B.id.versionNumber&&sa.deleteCurrentQuotation().then(()=>{s(ta(null))})})}),V([]))};v.useEffect(()=>{a&&m(we(a))},[a]);const Y=e.jsxs("div",{className:"flex flex-wrap gap-2 p-2 items-center",children:[e.jsx("h4",{className:"m-0 text-sm md:text-lg",children:"Cotizaciones"}),e.jsx(re,{value:d!=null&&d.data.total?`Total: ${d==null?void 0:d.data.total}`:"Total: 0"}),T.length>0&&e.jsx(re,{value:`${T.length} ${T.length===1?"cotización duplicada":"cotizaciones duplicadas"}`,severity:"success",className:"text-white"})]});return e.jsxs(e.Fragment,{children:[e.jsx(ia,{className:"mt-10 mb-4",start:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{icon:"pi pi-trash",label:"Eliminar",loading:H,onClick:Re,disabled:!E.length||A||H}),e.jsx(w,{icon:"pi pi-clone",label:"Duplicar",onClick:De,loading:A,severity:"secondary",disabled:!E.length||A||H})]})}),e.jsx(ge,{isLoader:S||R,loadingComponent:e.jsx(xe,{pt:{header:{className:"!bg-secondary"}},showGridlines:!0,header:Y,headerColumnGroup:Aa,value:Array.from({length:(d==null?void 0:d.data.content.length)||i}),children:Array.from({length:14}).map((h,j)=>e.jsx(l,{body:()=>e.jsx(fe,{shape:"rectangle",height:"1.5rem"})},j))}),fallBackComponent:e.jsx($,{value:[],header:Y,extraColumns:[{expander:h=>h.hasUnofficialVersions,position:"start"}],showGridlines:!0,emptyMessage:e.jsx("div",{className:"p-4",children:e.jsx(Ne,{refetch:K,isFetching:R,isLoading:S,message:"No se pudieron cargar las cotizaciones"})})}),error:W,children:e.jsx($,{stateStorage:"custom",stateKey:ie,customSaveState:f,value:(d==null?void 0:d.data.content)||[],expandedRows:Ce,extraColumns:[{expander:h=>h.hasUnofficialVersions,position:"start"},{header:"Reserva relacionada",body:h=>{var ee,ae,se;if(!((ee=h==null?void 0:h.reservation)!=null&&ee.id))return"Ninguno";const{icon:j,label:k,severity:B}=ea[(ae=h.reservation)==null?void 0:ae.status];return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["#",(se=h.reservation)==null?void 0:se.id]}),e.jsx(I,{icon:j,severity:B,value:k})]})},position:"end"}],first:c,rows:i,totalRecords:d==null?void 0:d.data.total,onPage:r,onFilter:r,rowsPerPageOptions:le,loading:S||R,lazy:!0,paginatorClassName:"max-sm:text-xs",size:"small",editMode:"cell",className:"text-sm lg:text-[15px] mt-5",sortMode:"single",dataKey:h=>`${h.id.quotationId}${h.id.versionNumber}`,sortField:p==null?void 0:p.sortField,sortOrder:p==null?void 0:p.sortOrder,filters:a,selectionMode:"checkbox",onRowExpand:h=>{const{id:j}=h.data;J({[`${j.quotationId}${j.versionNumber}`]:!0}),Pe(h.data)},onRowCollapse:()=>{J({})},selection:E,onSelectionChange:h=>{V(h.value)},header:Y,rowClassName:h=>({"bg-green-100":T.length>0&&T.some(j=>j.id.quotationId===h.id.quotationId&&j.id.versionNumber===h.id.versionNumber)}),rowExpansionTemplate:()=>e.jsx(ya,{selectedQuotes:E,setSelectedQuotes:V,recentDuplicatedQuotes:T,currentRowExpanded:Ee}),tableStyle:{minWidth:"60rem"},paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",paginator:!0,showGridlines:!0,filterDisplay:"menu",currentPageReportTemplate:"Mostrando del {first} al {last} de {totalRecords} cotizaciones",emptyMessage:"No hay cotizaciones"})})]})},Aa=e.jsx(be,{children:e.jsxs(ye,{children:[e.jsx(l,{}),e.jsx(l,{header:"Código",headerClassName:"min-w-24"}),e.jsx(l,{header:"Nombre",filter:!0,headerClassName:"min-w-32"}),e.jsx(l,{header:"Cliente",filter:!0,headerClassName:"min-w-48"}),e.jsx(l,{header:"Pasajeros",headerClassName:"min-w-24"}),e.jsx(l,{header:"Fecha de inicio",filter:!0,headerClassName:"min-w-48"}),e.jsx(l,{header:"Fecha de fin",filter:!0,headerClassName:"min-w-32"}),e.jsx(l,{header:"Precio"}),e.jsx(l,{header:"Representante",headerClassName:"min-w-32",filter:!0}),e.jsx(l,{header:"Avance"}),e.jsx(l,{header:"Precio"}),e.jsx(l,{header:"Status",filter:!0}),e.jsx(l,{header:"Oficial",headerClassName:"min-w-24"}),e.jsx(l,{header:"Acciones"})]})}),Ia=()=>e.jsxs("div",{className:"bg-white p-10 rounded-lg shadow-md overflow-x-hidden",children:[e.jsxs("div",{className:"flex justify-end flex-wrap gap-y-5 space-x-4",children:[e.jsx(w,{label:"Exportar",className:"bg-transparent text-black border-[#D0D5DD]",icon:"pi pi-download"}),e.jsx(ra,{})]}),e.jsx(Ca,{})]});export{Ia as default};
