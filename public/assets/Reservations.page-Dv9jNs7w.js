import{j as e,b3 as K,K as f,bh as p,ba as J,ay as U,bd as _,as as I,bi as H,r as h,J as $,B as W,aK as w,aL as r,S as X,aa as Y,z as x,w as C,au as Z}from"./index-CuLqlplA.js";import{f as ee}from"./format-D-vkVYqJ.js";import{u as te,T as ae,C as re,U as se,a as M,F as N,b as P}from"./FilterByDate-BtVl9F5_.js";import{T as y}from"./tag.esm-CNPfOU1N.js";import{E as ie,D as le}from"./ErrorBoundary-BtHloam8.js";import{a as ne,R as T}from"./row.esm-D5Ip8nO1.js";import"./phoneNumber.adapter-C09bg4A8.js";const oe=(t,s)=>Array.isArray(s)&&s.length===0?!0:Array.isArray(s)?s.some(i=>(i==null?void 0:i.id)===t):!1,ce=t=>{var s;return{createdAt:t.createdAt.constraints[0].value??void 0,updatedAt:t.updatedAt.constraints[0].value??void 0,status:((s=t.status.constraints[0].value)==null?void 0:s.map(i=>i.id))??void 0}},de=({options:t})=>e.jsx(K,{value:t.value||[],options:Object.values(f).map(s=>({label:p[s].label,id:s})),display:"chip",itemTemplate:({id:s})=>{const{label:i,severity:o,icon:n}=p[s];return e.jsx(y,{value:i,severity:o,icon:n})},onChange:s=>{t.filterCallback(s.value,t.index)},dataKey:"id",placeholder:"Selecciona un estado",selectAllLabel:"Todos",className:"p-column-filter"}),ue=({options:t,setCancelReservation:s})=>{const[i]=J(),o=async n=>{var d;if(t.rowData.id){if(n===f.REJECTED){s(t.rowData);return}await i({quotationId:t.rowData.versionQuotation.id.quotationId,status:n,id:t.rowData.id}),(d=t.editorCallback)==null||d.call(t,t.value)}};return e.jsx(U,{value:t.rowData.status,options:[{...p[f.ACTIVE],value:f.ACTIVE},{...p[f.REJECTED],value:f.REJECTED},{...p[f.PENDING],value:f.PENDING}],itemTemplate:n=>e.jsx(y,{value:n.label,severity:n.severity,icon:n.icon}),valueTemplate:()=>{const{label:n,severity:d,icon:m}=p[t.value??t.rowData.status];return e.jsx(y,{value:n,severity:d,icon:m})},onChange:n=>{o(n.value)},placeholder:"Seleccionar tipo de cotización",className:"w-full"})},me=({cancelReservation:t,setCancelReservation:s})=>{const[i]=_(),o=async()=>{t&&(await i(t.id),s(null))};return e.jsx(I,{group:"declarative",className:"max-w-md",visible:t!==null,onHide:()=>s(null),accept:o,reject:()=>s(null),icon:"pi pi-exclamation-triangle",acceptLabel:"Sí",message:"¿Está seguro que desea cancelar la reserva?, porque la cotización que está relacionada se cancelará también."})},fe=({selectedReservations:t,setSelectedReservations:s,visible:i,onHide:o})=>{const[n]=H(),d=async()=>{t.length!==0&&await n(t.map(m=>m.id)).unwrap().then(()=>{s([]),o(!1)})};return e.jsx(I,{group:"declarative",className:"max-w-md",visible:i,onHide:()=>o(!1),accept:d,reject:()=>o(!1),icon:"pi pi-exclamation-triangle",acceptLabel:"Sí",message:`¿Está seguro que desea eliminar las siguientes reservas: ${t.map(m=>m.id).join(", ")}? Porque las cotizaciones que están relacionadas se eliminaran también, junto con sus versiones.`})},{RESERVATION_PAGINATION:B}=Z,z=[10,20,30],he=()=>{const t=h.useRef(null),{currentPage:s,limit:i,filters:o,first:n,handlePageChange:d,handleSaveState:m}=te(z[0],B),[{status:k,createdAt:L,updatedAt:q},G]=h.useState({}),{currentData:j,isFetching:E,isLoading:D,refetch:Q,isError:v}=$({page:s,limit:i,status:k,createdAt:L,updatedAt:q}),u=j==null?void 0:j.data,[b,R]=h.useState([]),[O,S]=h.useState(!1),[V,F]=h.useState(null);return h.useEffect(()=>{o&&G(ce(o))},[o]),h.useEffect(()=>{if(!v)return;const a=document.querySelector("#fallback-reservations .p-datatable-emptymessage td");a&&a.setAttribute("colspan","12")},[v]),e.jsxs("div",{children:[e.jsx(me,{cancelReservation:V,setCancelReservation:F}),e.jsx(fe,{selectedReservations:b,visible:O,onHide:S,setSelectedReservations:R}),e.jsxs("div",{className:"card",children:[e.jsx(ae,{className:"mb-4",start:e.jsx("div",{className:"flex gap-x-5",children:e.jsx(W,{type:"button",label:"Eliminar",icon:"pi pi-trash",disabled:!b.length,onClick:()=>{S(!0)}})})}),e.jsx(ie,{isLoader:E||D,loadingComponent:e.jsx(w,{pt:{header:{className:"!bg-secondary"}},showGridlines:!0,headerColumnGroup:A,value:Array.from({length:(u==null?void 0:u.content.length)||10}),lazy:!0,size:"small",emptyMessage:"No hay cotizaciones",children:Array.from({length:12}).map((a,l)=>e.jsx(r,{field:`loading-${l}`,header:"Cargando...",body:()=>e.jsx(X,{shape:"rectangle",height:"1.5rem"})},l))}),fallBackComponent:e.jsx(w,{pt:{header:{className:"!bg-secondary"}},id:"fallback-reservations",showGridlines:!0,headerColumnGroup:A,value:[],lazy:!0,size:"small",emptyMessage:e.jsx(le,{refetch:Q,isFetching:E,isLoading:D,message:"No se pudieron cargar las reservaciones"})}),error:v,children:e.jsxs(w,{ref:t,scrollable:!0,size:"small",stateStorage:"custom",stateKey:B,customSaveState:a=>{m({first:n,rows:i,filters:a.filters})},showGridlines:!0,value:(u==null?void 0:u.content)||[],selection:b,onSelectionChange:a=>{Array.isArray(a.value)&&R(a.value)},className:"md:text-sm",emptyMessage:"No hay reservaciones",filterDisplay:"menu",onFilter:d,filters:o,headerColumnGroup:A,rows:i,editMode:"cell",dataKey:"id",pt:{footer:{className:"bg-white"}},footer:e.jsx(Y,{first:n,rows:i,totalRecords:(u==null?void 0:u.total)||0,rowsPerPageOptions:z,onPageChange:a=>{d(a),m({first:a.first,rows:a.rows,filters:o})},template:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando del {first} al {last} de {totalRecords} cotizaciones"}),selectionMode:"multiple",children:[e.jsx(r,{selectionMode:"multiple"}),e.jsx(r,{field:"id",align:"center"}),e.jsx(r,{align:"center",filterMatchMode:"custom",filterFunction:oe,filterType:"custom",body:a=>{const{label:l,severity:c,icon:g}=p[a.status];return e.jsx(y,{value:l,severity:c,icon:g})},editor:a=>e.jsx(ue,{options:a,setCancelReservation:F}),filterField:"status"}),e.jsx(r,{align:"center",dataType:"date",filterMatchMode:"gte",filterType:"dateIs",filterField:"createdAt",body:a=>x.format(a.createdAt)}),e.jsx(r,{align:"center",filterField:"updatedAt",body:a=>x.format(a.updatedAt)}),e.jsx(r,{headerClassName:"min-w-24",className:"min-w-24",header:"Código",body:({versionQuotation:a})=>a?e.jsxs("label",{children:["Q",a.id.quotationId,"-V",a.id.versionNumber]}):""}),e.jsx(r,{field:"versionQuotation.name",align:"center"}),e.jsx(r,{body:a=>{var c,g;const l=(g=(c=a.versionQuotation)==null?void 0:c.tripDetails)==null?void 0:g.client;return l?e.jsx(re,{client:l}):""}}),e.jsx(r,{align:"center",body:a=>{var l;return(l=a.versionQuotation)!=null&&l.tripDetails?x.format(a.versionQuotation.tripDetails.startDate):""}}),e.jsx(r,{align:"center",body:a=>{var l;return(l=a.versionQuotation)!=null&&l.tripDetails?x.format(a.versionQuotation.tripDetails.endDate):""}}),e.jsx(r,{align:"center",body:a=>{var c;const l=(c=a.versionQuotation)==null?void 0:c.finalPrice;return ee(l??0)}}),e.jsx(r,{header:"Cotización",align:"center",body:a=>{var c;const l=(c=a.versionQuotation)==null?void 0:c.user;return l?e.jsx(se,{user:l}):""}})]})})]})]})},A=e.jsxs(ne,{children:[e.jsxs(T,{children:[e.jsx(r,{headerClassName:"bg-primary text-white",selectionMode:"multiple"}),e.jsx(r,{headerClassName:"bg-primary text-white",header:"Código",align:"center"}),e.jsx(r,{headerClassName:"bg-primary text-white",header:"Estado",align:"center",filterHeaderClassName:"bg-red-400",filterField:"status",pt:{filterMenuButton:({context:t})=>({className:C("text-white hover:bg-tertiary bg-primary focus:bg-tertiary",{"bg-tertiary text-white":t.active})})},showFilterMatchModes:!1,showFilterOperator:!1,showAddButton:!1,filter:!0,filterElement:t=>e.jsx(de,{options:t}),filterApply:t=>e.jsx(M,{...t}),filterClear:t=>e.jsx(N,{...t})}),e.jsx(r,{showFilterMatchModes:!1,showFilterOperator:!1,showAddButton:!1,showApplyButton:!1,filterField:"createdAt",dataType:"date",filterMatchMode:"gte",filterType:"dateIs",pt:{filterMenuButton:({context:t})=>({className:C("text-white hover:bg-tertiary bg-primary focus:bg-tertiary",{"bg-tertiary text-white":t.active})})},filter:!0,filterClear:t=>e.jsx(N,{...t}),filterElement:t=>e.jsx(P,{options:t,placeholder:"Selecciona una fecha"}),headerClassName:"bg-primary text-white min-w-32",header:"Fecha de creación",align:"center"}),e.jsx(r,{showFilterMatchModes:!1,showFilterOperator:!1,showAddButton:!1,filterField:"updatedAt",pt:{filterMenuButton:({context:t})=>({className:C("text-white hover:bg-tertiary bg-primary focus:bg-tertiary",{"bg-tertiary text-white":t.active})})},filterApply:t=>e.jsx(M,{...t}),filterClear:t=>e.jsx(N,{...t}),filter:!0,filterElement:t=>e.jsx(P,{options:t,placeholder:"Selecciona una fecha"}),headerClassName:"bg-primary text-white min-w-32",header:"Última actualización",align:"center"}),e.jsx(r,{header:e.jsxs("div",{className:"text-sm  flex items-center gap-x-2",children:[e.jsx("i",{className:"text-sm pi pi-file"}),"Detalles de cotización"]}),align:"center",colSpan:10})]}),e.jsxs(T,{children:[e.jsx(r,{colSpan:5}),e.jsx(r,{header:"Código"}),e.jsx(r,{header:"Nombre"}),e.jsx(r,{header:"Cliente",headerClassName:"min-w-48"}),e.jsx(r,{header:"Fecha de inicio"}),e.jsx(r,{header:"Fecha de fin"}),e.jsx(r,{header:"Precio"}),e.jsx(r,{header:"Representante"})]})]}),we=()=>e.jsx("div",{className:"bg-white p-10 rounded-lg shadow-md",children:e.jsx(he,{})});export{we as default};
