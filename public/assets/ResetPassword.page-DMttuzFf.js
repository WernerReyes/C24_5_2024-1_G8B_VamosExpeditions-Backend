import{u as S,e as j,f as h,r as l,g as k,h as C,c as P,j as o,D as N,P as D}from"./index-J8QxsPFL.js";import{u as E,t as I,C as R}from"./zod-CN8eM6yK.js";import{A as T}from"./AuthFormLayout-C6EPec_5.js";class d extends Error{}d.prototype.name="InvalidTokenError";function $(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,s)=>{let a=s.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a}))}function L(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return $(e)}catch{return atob(e)}}function M(t,e){if(typeof t!="string")throw new d("Invalid token specified: must be a string");e||(e={});const s=e.header===!0?0:1,a=t.split(".")[s];if(typeof a!="string")throw new d(`Invalid token specified: missing part #${s+1}`);let i;try{i=L(a)}catch(r){throw new d(`Invalid token specified: invalid base64 for part #${s+1} (${r.message})`)}try{return JSON.parse(i)}catch(r){throw new d(`Invalid token specified: invalid json for part #${s+1} (${r.message})`)}}const z=()=>{const t=S(),{token:e}=j(),{control:s,handleSubmit:a,formState:{errors:i}}=E({resolver:I(h.getSchema),defaultValues:h.getDefault({token:e})}),[r,f]=l.useState(null),[g,w]=l.useState(0),[u,m]=l.useState(!1),{isError:p,isFetching:x}=k(e,{skip:!e||(r==null?void 0:r.exp)>Date.now()/1e3,refetchOnMountOrArgChange:!0}),[b,{isLoading:v}]=C(),y=async n=>{await b(n).unwrap().then(async()=>{m(!0)})};return l.useEffect(()=>{if(e)try{const n=M(e);f(n),w(function(){const c=Math.floor(Date.now()/1e3);return((n==null?void 0:n.exp)??0)-c}())}catch{f(null)}},[e]),l.useEffect(()=>{(p||!e||(r==null?void 0:r.exp)<Date.now()/1e3||u)&&t(P.public.LOGIN)},[p,r,e,u]),x?null:o.jsxs(T,{title:"Cambiar Contraseña",description:"Ingresa tu nueva contraseña",handleSubmit:a(y),loading:v,disabled:Object.keys(i).length>0||u,buttonLabel:"Cambiar Contraseña",children:[o.jsx("div",{className:"mx-auto",children:o.jsx(N,{isPlaying:!0,duration:g,colors:["#01495d","#01a3bb","#f4f6f6"],colorsTime:[7,5,2],size:100,strokeWidth:5,trailStrokeWidth:5,trailColor:"#d9d9d9",strokeLinecap:"round",onComplete:()=>{m(!0)},children:({remainingTime:n})=>o.jsxs("div",{className:"flex flex-col items-center justify-center",children:[o.jsx("i",{className:"pi pi-stopwatch text-primary mb-1"}),o.jsx("span",{className:"text-xl font-semibold text-vamos-text",children:O({remainingTime:n})})]})})}),o.jsx("div",{className:"mt-5",children:o.jsx(R,{control:s,name:"newPassword",defaultValue:"aLTEC123488777@",render:({field:n,fieldState:{error:c}})=>o.jsx(D,{label:{htmlFor:"newPassword",text:"Nueva Contraseña",className:"text-tertiary font-bold"},small:{text:c==null?void 0:c.message,className:"text-red-500"},feedback:!1,placeholder:"Contraseña",toggleMask:!0,invalid:!!c,...n})})})]})},O=({remainingTime:t})=>{const e=Math.floor(t%3600/60),s=t%60,a=String(e).padStart(2,"0"),i=String(s).padStart(2,"0");return`${a}:${i}`};export{z as default};
